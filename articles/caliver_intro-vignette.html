<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An introduction to the caliver package • caliver</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to the caliver package">
<meta property="og:description" content="caliver">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">caliver</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://doi.org/10.1371/journal.pone.0189419">PLOS ONE paper</a>
    </li>
    <li>
      <a href="../articles/index.html">Vignettes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ecmwf/caliver/">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="caliver_intro-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An introduction to the caliver package</h1>
                        <h4 class="author">Claudia Vitolo</h4>
            
            <h4 class="date">2021-01-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ecmwf/caliver/blob/master/vignettes/caliver_intro-vignette.Rmd"><code>vignettes/caliver_intro-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>caliver_intro-vignette.Rmd</code></div>

    </div>

    
    
<p>The name caliver stands for <strong>CALI</strong>bration and <strong>VER</strong>ification of gridded model outputs. It is a package developed for the R programming language and available with an APACHE-2 license from a public repository. The caliver package was initially designed for the post-processing, calibration and validation/verification of Forest Fire models but as development progressed, it became clear that it could have a much wider applicability. The goal of this vignette is to describe the functionalities of the package, examples are given with regard to outputs of the following forest fire models: GEFF and RISICO. Applicability to other model results will be investigated in future works. Complete documentation is available within the package. This vignette contains the code to run all the examples in <span class="citation">(Vitolo, Di Giuseppe, and D’Andrea 2018)</span>, please refer to this paper for more information.</p>
<div id="package-installation-and-dependencies" class="section level2">
<h2 class="hasAnchor">
<a href="#package-installation-and-dependencies" class="anchor"></a>Package installation and dependencies</h2>
<p>The caliver package is implemented in the R statistical language and depends on the following external libraries: the Geospatial Data Abstraction Library <span class="citation">(Warmerdam 2008)</span> a translator library for raster and vector geospatial data formats and the NetCDF4 library <span class="citation">(Rew and Davis 1990)</span>.</p>
<p>Installation instructions for different operating systems are available in the README file. A Dockefile is provided with the source code and docker image (ecmwf/caliver) is available from docker hub.</p>
<p>Once all the dependencies are available, the package can be installed via <a href="https://github.com/hadley/devtools">devtools</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Install caliver from GitHub via devtools</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ecmwf/caliver"</span><span class="op">)</span></code></pre></div>
<p>Load the caliver package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ecmwf.github.io/caliver">"caliver"</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="sample-regions" class="section level2">
<h2 class="hasAnchor">
<a href="#sample-regions" class="anchor"></a>Sample regions</h2>
<p>The fourth-generation global fire emissions database  provides as ancillary data a map of 14 basis regions used to evaluate regional annual emission estimates. This map is included in the caliver package and can be retrieved as SpatialPolygonsDataFrame (a spatial class defined in the sp package) as follows.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get all the GFED4 basis regions</span>
<span class="va">BasisRegions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GFED4_BasisRegions.rds"</span>,
                                    package <span class="op">=</span> <span class="st">"caliver"</span><span class="op">)</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/edzer/sp/">"sp"</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">BasisRegions</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Europe can be subsetted as follows</span>
<span class="va">Europe</span> <span class="op">&lt;-</span> <span class="va">BasisRegions</span><span class="op">[</span><span class="va">BasisRegions</span><span class="op">$</span><span class="va">Region</span> <span class="op">==</span> <span class="st">"EURO"</span>,<span class="op">]</span></code></pre></div>
<p>Get administrative areas using getdata from the raster package</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># United Kingdom</span>
<span class="va">UnitedK</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"United Kingdom"</span>, 
                           level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="co"># Spain</span>
<span class="va">Spain</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"Spain"</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Italy</span>
<span class="va">Italy</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"Italy"</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Italian regions</span>
<span class="va">Italy1</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"Italy"</span>, level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># Get polygons for Liguria, Calabria and Sicily</span>
<span class="va">Liguria</span> <span class="op">&lt;-</span> <span class="va">Italy1</span><span class="op">[</span><span class="fl">9</span>,<span class="op">]</span>
<span class="va">Calabria</span> <span class="op">&lt;-</span> <span class="va">Italy1</span><span class="op">[</span><span class="fl">4</span>,<span class="op">]</span>
<span class="va">Sicily</span> <span class="op">&lt;-</span> <span class="va">Italy1</span><span class="op">[</span><span class="fl">15</span>,<span class="op">]</span>

<span class="co"># Get polygon for the Province of Genoa</span>
<span class="va">Italy2</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"Italy"</span>, level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">Genoa</span> <span class="op">&lt;-</span> <span class="va">Italy2</span><span class="op">[</span><span class="fl">42</span>,<span class="op">]</span></code></pre></div>
</div>
<div id="analysis-and-visualisation" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-and-visualisation" class="anchor"></a>Analysis and visualisation</h2>
<p>A first understanding of how FWI value are distributed over time can be achieved by creating a map of percentiles. In the example below we generate two maps: 1 for the median and the othe for the 90th percentile.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_percentile_raster.html">get_percentile_raster</a></span><span class="op">(</span>input_file <span class="op">=</span> <span class="st">"FWI.nc"</span>, probs <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_percentile_raster.html">get_percentile_raster</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">b</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="maskcropsubset" class="section level3">
<h3 class="hasAnchor">
<a href="#maskcropsubset" class="anchor"></a>Mask/crop/subset</h3>
<p>FWI values are related to the local vegetation as well as to localised soil and atmospheric conditions during the dry season. For this reason it is often useful to look at spatio-temporal subsets of the full reanalysis dataset. In the example below, the function <code><a href="../reference/mask_crop_subset.html">mask_crop_subset()</a></code> is used to extract the 50th and 90th percentiles (setting argument <code>idx = c(1, 3)</code>), masked and cropped over Europe.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mapItaly</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">maps</span>, p <span class="op">=</span> <span class="va">Italy</span>, idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="plot" class="section level3">
<h3 class="hasAnchor">
<a href="#plot" class="anchor"></a>Plot</h3>
<p>The function <code>plotPercentiles()</code> provides a modified version of the <code><a href="https://rdrr.io/pkg/raster/man/plot.html">raster::plot()</a></code> function. Below is a comparison.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use the raster plot method</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">mapItaly</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FWI 50th perc."</span>, <span class="st">"FWI 90th perc."</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Use the caliver plotPercentiles function</span>
<span class="fu"><a href="../reference/plot_percentile_raster.html">plot_percentile_raster</a></span><span class="op">(</span>maps <span class="op">=</span> <span class="va">mapItaly</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FWI 50th perc."</span>, <span class="st">"FWI 90th perc."</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="define-fire-season" class="section level3">
<h3 class="hasAnchor">
<a href="#define-fire-season" class="anchor"></a>Define fire season</h3>
<p>In order to calculate the danger classes, the FWI brick should be loaded and the indices corresponding to the local fire season should be identified. In the example below the fire season is assumed constant across Europe, starting in April and ending in October each year.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataDates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"1980-01-01"</span><span class="op">)</span>,
                      to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2016-12-31"</span><span class="op">)</span>,
                      by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
                      
<span class="co"># Define a function to extract fire seasons in Europe</span>
<span class="va">seasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fire_season.html">get_fire_season</a></span><span class="op">(</span>dates <span class="op">=</span> <span class="va">dataDates</span>, zone <span class="op">=</span> <span class="st">"north"</span><span class="op">)</span>

<span class="co"># Create an index of fire season dates</span>
<span class="va">fireSeasonIndex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">seasons</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="calculate-danger-levels" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-danger-levels" class="anchor"></a>Calculate danger levels</h3>
<p>Threshold for every area of interest are calculate on the subset of the FWI brick related to the fire season only and cropped over the area of interest. Below are examples calculated for various countries in Europe, regions and a province in Italy. The result shows that fire danger classes is generally correlated to the local climate and spatial variability appears to be meaningful up to regional level.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load FWI dataset obtained previously</span>
<span class="va">FWI</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"FWI.nc"</span><span class="op">)</span>

<span class="co"># Mask/Crop/Subset FWI over Europe</span>
<span class="va">FWIEURO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">Europe</span>, idx <span class="op">=</span> <span class="va">fireSeasonIndex</span><span class="op">)</span>
                    
<span class="co"># Calculate levels</span>
<span class="va">EuropeThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWIEURO</span><span class="op">)</span>

<span class="co"># Country level: use a loop to calculate levels for all the countries in the EU:</span>
<span class="co"># This does not take into account Greenland, Cyprus, Andorra and Luxembrourg.</span>
<span class="va">EUcountries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Austria"</span>, <span class="st">"Belgium"</span>, <span class="st">"Bulgaria"</span>, <span class="st">"Croatia"</span>,
                 <span class="st">"Czech Republic"</span>, <span class="st">"Denmark"</span>, <span class="st">"Estonia"</span>, <span class="st">"Finland"</span>, <span class="st">"France"</span>,
                 <span class="st">"Germany"</span>, <span class="st">"Greece"</span>, <span class="st">"Hungary"</span>, <span class="st">"Ireland"</span>, <span class="st">"Italy"</span>, <span class="st">"Latvia"</span>,
                 <span class="st">"Lithuania"</span>, <span class="st">"Luxembourg"</span>, <span class="st">"Malta"</span>, <span class="st">"Netherlands"</span>, <span class="st">"Poland"</span>,
                 <span class="st">"Portugal"</span>, <span class="st">"Romania"</span>, <span class="st">"Slovakia"</span>, <span class="st">"Slovenia"</span>, <span class="st">"Spain"</span>,
                 <span class="st">"Sweden"</span>, <span class="st">"United Kingdom"</span><span class="op">)</span>
                 
<span class="kw">for</span> <span class="op">(</span><span class="va">singleCountry</span> <span class="kw">in</span> <span class="va">EUcountries</span><span class="op">)</span><span class="op">{</span>

  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">singleCountry</span><span class="op">)</span>

  <span class="co"># Mask/Crop/Subset FWI and generate thresholds for singleCountry</span>
  <span class="va">singleCountryFWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>,
                                       p <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>,
                                                           country <span class="op">=</span> <span class="va">singleCountry</span>,
                                                           level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
                                       idx <span class="op">=</span> <span class="va">fireSeasonIndex</span><span class="op">)</span>
  <span class="va">singleCountryThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">singleCountryFWI</span><span class="op">)</span>
  
  <span class="co"># Append values to data.frame</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">singleCountry</span> <span class="op">==</span> <span class="st">"Austria"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">singleCountryThr</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">singleCountryThr</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>

<span class="op">}</span>

<span class="va">EuroThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">EUcountries</span>, <span class="va">df</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">EuroThr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>, <span class="st">"VeryHigh"</span>, <span class="st">"Extreme"</span><span class="op">)</span>

<span class="co"># Regional level</span>
<span class="co"># Mask/Crop/Subset FWI and generate thresholds for Liguria</span>
<span class="va">LIG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">Liguria</span>, idx <span class="op">=</span> <span class="va">fireSeasonIndex</span><span class="op">)</span>
<span class="va">EuroThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">EuroThr</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Liguria"</span>, <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">LIG</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
                               
<span class="co"># Mask/Crop/Subset FWI and generate thresholds for Calabria</span>
<span class="va">CAL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">Calabria</span>, idx <span class="op">=</span> <span class="va">fireSeasonIndex</span><span class="op">)</span>
<span class="va">EuroThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">EuroThr</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Calabria"</span>, <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">CAL</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Mask/Crop/Subset FWI and generate thresholds for Sicily</span>
<span class="va">SIC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">Sicily</span>, idx <span class="op">=</span> <span class="va">fireSeasonIndex</span><span class="op">)</span>
<span class="va">EuroThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">EuroThr</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sicily"</span>, <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">SIC</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Province level</span>
<span class="co"># Mask/Crop/Subset FWI and generate thresholds for Genoa</span>
<span class="va">GEN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">Genoa</span>, idx <span class="op">=</span> <span class="va">fireSeasonIndex</span><span class="op">)</span>
<span class="va">EuroThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">EuroThr</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Genoa"</span>, <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">GEN</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Remove NAs, e.g. Luxembourg and Malta are too small compared to the ratser resolution</span>
<span class="va">EuroThr</span> <span class="op">&lt;-</span> <span class="va">EuroThr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">EuroThr</span><span class="op">)</span>,<span class="op">]</span>

<span class="va">EuroThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">EuroThr</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Europe"</span>, <span class="va">EuropeThr</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Save table with thresholds for future use</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">EuroThr</span>, <span class="st">"EuroThr.rds"</span><span class="op">)</span></code></pre></div>
</div>
<div id="plot-density-with-thresholds" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-density-with-thresholds" class="anchor"></a>Plot density with thresholds</h3>
<p>The thresholds are different from the percentiles, the PDF below shows a comparison for Italy.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">countryPDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_fire_pdf.html">plot_fire_pdf</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">IT</span>,
                            thresholds <span class="op">=</span> <span class="va">EuroThr</span><span class="op">[</span><span class="st">"Italy"</span>, <span class="op">]</span>, 
                            upper_limit <span class="op">=</span> <span class="fl">75</span>,
                            v_lines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="validate-danger-levels" class="section level3">
<h3 class="hasAnchor">
<a href="#validate-danger-levels" class="anchor"></a>Validate danger levels</h3>
<p>Test whether large fires correspond to FWI above high danger</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"pROC"</span><span class="op">)</span>

<span class="va">BurnedAreas</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"GFED4_BurnedAreas/BurnedArea.grd"</span><span class="op">)</span>

<span class="co"># Mask and crop burned areas over Europe</span>
<span class="va">BA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">BurnedAreas</span>, p <span class="op">=</span> <span class="va">Europe</span><span class="op">)</span>

<span class="co"># If observations layers have no date, assign it!</span>
<span class="va">dataDates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2003-01-01"</span><span class="op">)</span>,
                      to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2015-12-31"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">BA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dataDates</span>

<span class="va">EuroThrHigh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">EuroThr</span><span class="op">[</span><span class="va">EuroThr</span><span class="op">$</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"Europe"</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span>

<span class="co"># The above can be saved and re-loaded as follows:</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">BA</span>, filename<span class="op">=</span><span class="st">"BurnedAreaEurope.grd"</span>,
                    bandorder<span class="op">=</span><span class="st">'BIL'</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="st">'text'</span><span class="op">)</span>
<span class="va">BurnedAreaEurope</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"BurnedAreaEurope.grd"</span><span class="op">)</span>

<span class="co"># For the validation we do not want to subset over the fire season, subset to match days in BurnedAreaEurope</span>
<span class="va">FWIEURO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">Europe</span>, idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">FWI</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">BurnedAreaEurope</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># The above can be saved and re-loaded as follows:</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">FWIEURO</span>, filename<span class="op">=</span><span class="st">"FWIEURO.grd"</span>, bandorder<span class="op">=</span><span class="st">'BIL'</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="st">'text'</span><span class="op">)</span>
<span class="va">FWIEURO</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"FWIEURO.grd"</span><span class="op">)</span>

<span class="co"># Contingency table for JRC - Europe as a whole</span>
<span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_fire_danger_levels.html">validate_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWIEURO</span>, observation <span class="op">=</span> <span class="va">BurnedAreaEurope</span>,
                                 fire_threshold <span class="op">=</span> <span class="fl">21.3</span>, obs_threshold <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">tab_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="va">x1</span><span class="op">$</span><span class="va">pred</span>, obs <span class="op">=</span> <span class="va">x1</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span>
<span class="va">hits</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">misses</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">correct_negatives</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">false_alarms</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>
<span class="co"># POD 47%</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">hits</span><span class="op">/</span><span class="op">(</span><span class="va">hits</span><span class="op">+</span><span class="va">misses</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>
<span class="va">roc1</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu">roc</span><span class="op">(</span>response <span class="op">=</span> <span class="va">x1</span><span class="op">$</span><span class="va">obs</span>, predictor <span class="op">=</span> <span class="va">x1</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>
<span class="fu">pROC</span><span class="fu">::</span><span class="fu">plot.roc</span><span class="op">(</span><span class="va">roc1</span>, print.auc <span class="op">=</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu">auc</span><span class="op">(</span><span class="va">roc1</span><span class="op">)</span>, print.auc.x <span class="op">=</span> <span class="fl">0</span>, print.auc.y <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>

<span class="co"># Contingency table for caliver - Europe as a whole</span>
<span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_fire_danger_levels.html">validate_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWIEURO</span>, observation <span class="op">=</span> <span class="va">BurnedAreaEurope</span>,
                                 fire_threshold <span class="op">=</span> <span class="va">EuroThrHigh</span>, obs_threshold <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">tab_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="va">x2</span><span class="op">$</span><span class="va">pred</span>, obs <span class="op">=</span> <span class="va">x2</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span>
<span class="va">hits</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">misses</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>
<span class="co"># POD 65%</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">hits</span><span class="op">/</span><span class="op">(</span><span class="va">hits</span><span class="op">+</span><span class="va">misses</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>
<span class="va">roc2</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu">roc</span><span class="op">(</span>response <span class="op">=</span> <span class="va">x2</span><span class="op">$</span><span class="va">obs</span>, predictor <span class="op">=</span> <span class="va">x2</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>
<span class="fu">pROC</span><span class="fu">::</span><span class="fu">plot.roc</span><span class="op">(</span><span class="va">roc2</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>,
               print.auc <span class="op">=</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu">auc</span><span class="op">(</span><span class="va">roc2</span><span class="op">)</span>, print.auc.x <span class="op">=</span> <span class="fl">0</span>, print.auc.y <span class="op">=</span> <span class="fl">0.95</span>,
               print.auc.col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>


<span class="co"># Loop throught the countries</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">singleCountry</span> <span class="kw">in</span> <span class="va">EuroThr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">26</span>,<span class="st">"Country"</span><span class="op">]</span><span class="op">)</span><span class="op">{</span>

  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">singleCountry</span><span class="op">)</span>

  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">singleCountry</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cyprus"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

    <span class="va">countryPoly</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="va">singleCountry</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
    <span class="va">countryThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">EuroThr</span><span class="op">[</span><span class="va">EuroThr</span><span class="op">$</span><span class="va">Country</span> <span class="op">==</span> <span class="va">singleCountry</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span>

    <span class="co"># Crop RasterBricks over country of interest</span>
    <span class="va">BA_country</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">BurnedAreaEurope</span>, p <span class="op">=</span> <span class="va">countryPoly</span><span class="op">)</span>
    <span class="va">FWI_country</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWIEURO</span>, p <span class="op">=</span> <span class="va">countryPoly</span><span class="op">)</span>

    <span class="va">JRC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_fire_danger_levels.html">validate_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWI_country</span>, 
                                       observation <span class="op">=</span> <span class="va">BA_country</span>,
                                       fire_threshold <span class="op">=</span> <span class="fl">21.3</span>, 
                                       obs_threshold <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
    <span class="va">tab_JRC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">JRC</span><span class="op">$</span><span class="va">pred</span>, <span class="va">JRC</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
    <span class="va">caliver1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_fire_danger_levels.html">validate_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWI_country</span>, 
                                            observation <span class="op">=</span> <span class="va">BA_country</span>,
                                            fire_threshold <span class="op">=</span> <span class="va">EuroThrHigh</span>, 
                                            obs_threshold <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
    <span class="va">tab_caliver1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">caliver1</span><span class="op">$</span><span class="va">pred</span>, <span class="va">caliver1</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
    <span class="va">caliver2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_fire_danger_levels.html">validate_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWI_country</span>, 
                                            observation <span class="op">=</span> <span class="va">BA_country</span>,
                                            fire_threshold <span class="op">=</span> <span class="va">countryThr</span>, 
                                            obs_threshold <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
    <span class="va">tab_caliver2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">caliver2</span><span class="op">$</span><span class="va">pred</span>, <span class="va">caliver2</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
    
    <span class="kw">if</span> <span class="op">(</span><span class="va">singleCountry</span> <span class="op">==</span> <span class="st">"Austria"</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">df_caliver1</span> <span class="op">&lt;-</span> <span class="va">df_caliver2</span> <span class="op">&lt;-</span> <span class="va">df_effis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"pred"</span> <span class="op">=</span> <span class="va">tab_caliver1</span><span class="op">$</span><span class="va">pred</span>, <span class="st">"obs"</span> <span class="op">=</span> <span class="va">tab_caliver1</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span>
      <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">3</span>
    <span class="op">}</span>

    <span class="va">df_caliver1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df_caliver1</span>, <span class="va">tab_caliver1</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver1</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">singleCountry</span>
    <span class="va">df_caliver2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df_caliver2</span>, <span class="va">tab_caliver2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">singleCountry</span>
    <span class="va">df_effis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df_effis</span>, <span class="va">tab_JRC</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_effis</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">singleCountry</span>
    <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>

    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">countryPoly</span>, <span class="va">countryThr</span>, <span class="va">BA_country</span>, <span class="va">FWI_country</span><span class="op">)</span>

  <span class="op">}</span>

<span class="op">}</span>

<span class="co"># Save contingency tables</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df_caliver1</span>, <span class="st">"df_caliver1.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df_caliver2</span>, <span class="st">"df_caliver2.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df_effis</span>, <span class="st">"df_effis.rds"</span><span class="op">)</span>

<span class="co"># Europe (EFFIS danger levels)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">df_effis</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># hits</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">df_effis</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># misses</span>
<span class="co"># Europe (averaged danger levels)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">df_caliver1</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># hits</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">df_caliver1</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># misses</span>
<span class="co"># Europe (country-specific danger levels)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># hits</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># misses</span>

<span class="co"># UK (EFFIS danger levels)</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># UK (EU averaged danger levels)</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># UK (country-specific danger levels)</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
                                                   
<span class="co"># Spain (EFFIS danger levels)</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># Spain (EU averaged danger levels)</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># Spain (country-specific danger levels)</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
                                                   
<span class="co"># Italy (EFFIS danger levels)</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># Italy (EU averaged danger levels)</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># Italy (country-specific danger levels)</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span></code></pre></div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-rew1990netcdf">
<p>Rew, Russ, and Glenn Davis. 1990. “NetCDF: An Interface for Scientific Data Access.” <em>IEEE Computer Graphics and Applications</em> 10 (4): 76–82.</p>
</div>
<div id="ref-vitolo:2018">
<p>Vitolo, Claudia, Francesca Di Giuseppe, and Mirko D’Andrea. 2018. “Caliver: An R Package for Calibration and Verification of Forest Fire Gridded Model Outputs.” <em>PLOS ONE</em> 13 (1): 1–18. <a href="https://doi.org/10.1371/journal.pone.0189419">https://doi.org/10.1371/journal.pone.0189419</a>.</p>
</div>
<div id="ref-warmerdam2008geospatial">
<p>Warmerdam, Frank. 2008. “The Geospatial Data Abstraction Library.” In <em>Open Source Approaches in Spatial Data Handling</em>, 87–104. Springer.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Claudia Vitolo, Mirko D'Andrea.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
