<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verification of fire danger classes • caliver</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Verification of fire danger classes">
<meta property="og:description" content="caliver">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">caliver</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://doi.org/10.1371/journal.pone.0189419">PLOS ONE paper</a>
    </li>
    <li>
      <a href="../articles/index.html">Vignettes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ecmwf/caliver/">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="caliver_danger_classes-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Verification of fire danger classes</h1>
                        <h4 class="author">Claudia Vitolo</h4>
            
            <h4 class="date">2021-02-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ecmwf/caliver/blob/master/vignettes/caliver_danger_classes-vignette.Rmd"><code>vignettes/caliver_danger_classes-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>caliver_danger_classes-vignette.Rmd</code></div>

    </div>

    
    
<!--
# Copyright 2016 European Centre for Medium-Range Weather Forecasts (ECMWF)
# This software is licensed under the terms of the Apache Licence Version 2.0 
# which can be obtained at http://www.apache.org/licenses/LICENSE-2.0. 
# In applying this licence, ECMWF does not waive the privileges and immunities 
# granted to it by virtue of its status as an intergovernmental organisation nor
# does it submit to any jurisdiction.
-->
<p>The package caliver contains functions for the calibration and verification of gridded model outputs. The package was designed with a fire risk model in mind (GEFF) but, in the near future, this is going to develop in a model agnostic tool. The introductory vignette “An introduction to the caliver package” <span class="citation">(Vitolo, Di Giuseppe, and D’Andrea 2018)</span> contain a detailed description of the main functionalities of this package. The goal of this vignette, instead, is to describe how to use caliver to calculate and verify fire danger classes based on user-defined areas. This vignette contains the code to run all the analyses in <span class="citation">(Di Giuseppe et al., n.d.)</span>, please refer to this paper for more information on the methodology.</p>
<div id="r-package-caliver" class="section level2">
<h2 class="hasAnchor">
<a href="#r-package-caliver" class="anchor"></a>R package caliver</h2>
<p>For information on how to install and load caliver, please refer to the vignette “An introduction to the caliver package” and the README file in the repository.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Install caliver from GitHub</span>
<span class="co"># install.packages("devtools", repos = "http://cran.rstudio.com")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ecmwf/caliver"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ecmwf.github.io/caliver">"caliver"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://rspatial.org/raster">"raster"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"verification"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"rowr"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"rgeos"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://maptools.r-forge.r-project.org/">"maptools"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/edzer/sp/">"sp"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"RColorBrewer"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://stringr.tidyverse.org">"stringr"</a></span><span class="op">)</span>

<span class="co"># setwd("/hugetmp/publications/FireForecasting/data")</span>
<span class="co"># rasterOptions(tmpdir="/hugetmp/tmp")</span>
<span class="co"># Check path dirname(rasterTmpFile()) </span></code></pre></div>
</div>
<div id="get-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-data" class="anchor"></a>Get data</h2>
<div id="regionscountries-of-interest" class="section level4">
<h4 class="hasAnchor">
<a href="#regionscountries-of-interest" class="anchor"></a>Regions/countries of interest</h4>
<p>We will demonstrate how to calculate and validate fire danger levels for 4 GFED4 areas and countries:</p>
<ul>
<li>Europe (EURO) and Portugal,</li>
<li>Temperate North America (TENA) and California,</li>
<li>Southern Hemisphere South America (SHSA) and Chile.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_gfed4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">14</span>,
                 Region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BONA"</span>, <span class="st">"TENA"</span>, <span class="st">"CEAM"</span>, <span class="st">"NHSA"</span>, <span class="st">"SHSA"</span>, <span class="st">"EURO"</span>,
                            <span class="st">"MIDE"</span>, <span class="st">"NHAF"</span>, <span class="st">"SHAF"</span>, <span class="st">"BOAS"</span>, <span class="st">"CEAS"</span>, <span class="st">"SEAS"</span>,
                            <span class="st">"EQAS"</span>, <span class="st">"AUST"</span><span class="op">)</span>,
                 Zone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"north"</span>, <span class="st">"north"</span>, <span class="st">"tropics"</span>, <span class="st">"tropics"</span>, <span class="st">"south"</span>,
                          <span class="st">"north"</span>, <span class="st">"north"</span>, <span class="st">"tropics"</span>, <span class="st">"south"</span>, <span class="st">"north"</span>,
                          <span class="st">"north"</span>, <span class="st">"tropics"</span>, <span class="st">"tropics"</span>, <span class="st">"south"</span><span class="op">)</span>,
                 stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Get all the GFED4 basis regions</span>
<span class="va">BasisRegions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GFED4_BasisRegions.rds"</span>,
                                    package <span class="op">=</span> <span class="st">"caliver"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># GFED4 regions of interest</span>
<span class="va">EURO</span> <span class="op">&lt;-</span> <span class="va">BasisRegions</span><span class="op">[</span><span class="va">BasisRegions</span><span class="op">$</span><span class="va">Region</span> <span class="op">==</span> <span class="st">"EURO"</span>,<span class="op">]</span>
<span class="va">TENA</span> <span class="op">&lt;-</span> <span class="va">BasisRegions</span><span class="op">[</span><span class="va">BasisRegions</span><span class="op">$</span><span class="va">Region</span> <span class="op">==</span> <span class="st">"TENA"</span>,<span class="op">]</span>
<span class="va">SHSA</span> <span class="op">&lt;-</span> <span class="va">BasisRegions</span><span class="op">[</span><span class="va">BasisRegions</span><span class="op">$</span><span class="va">Region</span> <span class="op">==</span> <span class="st">"SHSA"</span>,<span class="op">]</span>

<span class="co"># Countries of interest</span>
<span class="va">pt</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"Portugal"</span>, level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">13</span><span class="op">)</span>, <span class="op">]</span>
<span class="va">chile</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"Chile"</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">cali</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"USA"</span>, level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span>, <span class="op">]</span> <span class="co"># cali</span>

<span class="co"># All the GFED4 regions</span>
<span class="va">BasisRegions_join</span> <span class="op">&lt;-</span> <span class="va">BasisRegions</span>
<span class="va">BasisRegions_join</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">BasisRegions_join</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>   <span class="co"># add id column for join</span>
<span class="va">regionXFort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op">(</span><span class="va">BasisRegions_join</span>, data <span class="op">=</span> <span class="va">BasisRegions_join</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>
<span class="va">regionXPoly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/merge.html">merge</a></span><span class="op">(</span><span class="va">regionXFort</span>, <span class="va">BasisRegions_join</span><span class="op">@</span><span class="va">data</span>, 
                     by.x <span class="op">=</span> <span class="st">"id"</span>, by.y <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>  <span class="co"># join data</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill<span class="op">=</span><span class="cn">NA</span>, colour <span class="op">=</span> <span class="st">"grey65"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Longitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">regionXPoly</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">layer</span><span class="op">)</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"GFED4 regions"</span>,
                    <span class="co"># values = viridis::viridis(14),</span>
                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkgrey"</span>,
                               <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">12</span>,<span class="st">"Paired"</span><span class="op">)</span>,
                               <span class="st">"lightgrey"</span><span class="op">)</span>,
                    labels <span class="op">=</span> <span class="va">regions</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">"world"</span>, region <span class="op">=</span> <span class="st">"Portugal"</span><span class="op">)</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, colour <span class="op">=</span> <span class="st">"Portugal"</span><span class="op">)</span>, 
               fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">"world"</span>, region <span class="op">=</span> <span class="st">"Chile"</span><span class="op">)</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, colour <span class="op">=</span> <span class="st">"Chile"</span><span class="op">)</span>, 
               fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span>map <span class="op">=</span> <span class="st">"state"</span>, region <span class="op">=</span> <span class="st">"California"</span><span class="op">)</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, colour <span class="op">=</span> <span class="st">"California"</span><span class="op">)</span>, 
               fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Study areas"</span>,
                      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Portugal"</span> <span class="op">=</span> <span class="st">"brown"</span>,
                                 <span class="st">"California"</span> <span class="op">=</span> <span class="st">"darkblue"</span>,
                                 <span class="st">"Chile"</span> <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="op">+</span><span class="fl">180</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">85</span>, <span class="op">+</span><span class="fl">85</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"figures/world.png"</span>, plot <span class="op">=</span> <span class="va">worldcountries</span>,
       device <span class="op">=</span> <span class="va">cairo_ps</span>, fallback_resolution <span class="op">=</span> <span class="fl">600</span>,
       width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1050</span>, <span class="st">"px"</span><span class="op">)</span>, height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">750</span>, <span class="st">"px"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Plot areas and countries of interest (Fig.1).</p>
<p><img src="figures/world.png" width="700"></p>
</div>
<div id="reanalysis-data" class="section level4">
<h4 class="hasAnchor">
<a href="#reanalysis-data" class="anchor"></a>Reanalysis data</h4>
<p>For a matter of consistency with the introductory vignette, we will use the FWI as index to estimate the fire danger classes. The first step is to download, from the <a href="http://apps.ecmwf.int/datasets/data/geff-reanalysis/">GEFF-reanalysis web app</a>, reanalysis data from 1980 to 2016. Assuming that data is downloaded in the folder “reanalysis” of the working directory, we can use <code>stack_netcdf_files()</code> to aggregate all the files into one netcdf file (this is not necessary if you have run through the examples in the intro vignette) and load it as RasterBrick. See the introductory vignette for more information.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># FWI reanalysis dataset, GEFF reanalysis v2.0</span>
<span class="va">FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"/hugetmp/GEFF_ERAI_Zenodo/fwi.nc"</span><span class="op">)</span> <span class="co"># 7GB!</span>
<span class="va">FWI</span> <span class="op">&lt;-</span> <span class="va">FWI</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">FWI</span><span class="op">@</span><span class="va">z</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2017-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="co"># only 1980-2016</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">FWI</span>, filename<span class="op">=</span><span class="st">"fwi_erai_1980_2016.nc"</span>, format<span class="op">=</span><span class="st">"CDF"</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="calculate-fire-danger-classes-by-gfed4-areas-and-countries" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-fire-danger-classes-by-gfed4-areas-and-countries" class="anchor"></a>Calculate fire danger classes by GFED4 areas and countries</h2>
<p>Calculate fire danger classes as shown in the introductory vignette.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define a vector with a sequence of dates related to the reanalysis</span>
<span class="va">dataDates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"1980-01-01"</span><span class="op">)</span>,
                      to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2016-12-31"</span><span class="op">)</span>,
                      by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>

<span class="co"># Initialise empty matrix to store thresholds</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>

<span class="co"># Mask/Crop/Subset FWI and generate thresholds for each GFED4 region</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">df_gfed4</span><span class="op">$</span><span class="va">Region</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">region</span> <span class="op">&lt;-</span> <span class="va">df_gfed4</span><span class="op">$</span><span class="va">Region</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">zone</span> <span class="op">&lt;-</span> <span class="va">df_gfed4</span><span class="op">$</span><span class="va">Zone</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">region</span>, <span class="va">zone</span><span class="op">)</span><span class="op">)</span>
  <span class="va">regionPoly</span> <span class="op">&lt;-</span> <span class="va">BasisRegions</span><span class="op">[</span><span class="va">BasisRegions</span><span class="op">$</span><span class="va">Region</span> <span class="op">==</span> <span class="va">region</span>,<span class="op">]</span>
  <span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_fire_season.html">get_fire_season</a></span><span class="op">(</span>dates <span class="op">=</span> <span class="va">dataDates</span>, zone <span class="op">=</span> <span class="va">zone</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">regionR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">regionPoly</span>, idx <span class="op">=</span> <span class="va">season</span><span class="op">)</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">region</span>, <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">regionR</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">df</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Location"</span>, <span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>, <span class="st">"Very high"</span>, <span class="st">"Extreme"</span><span class="op">)</span>
<span class="va">df</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">df</span>, FUN <span class="op">=</span> <span class="va">as.character</span><span class="op">)</span>
<span class="va">df</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, FUN <span class="op">=</span> <span class="va">as.numeric</span><span class="op">)</span>

<span class="co"># Mask/Crop/Subset FWI and generate thresholds for each country of interest</span>
<span class="va">regionData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">### Portugal ###</span>
<span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_fire_season.html">get_fire_season</a></span><span class="op">(</span>dates <span class="op">=</span> <span class="va">dataDates</span>, zone <span class="op">=</span> <span class="st">"north"</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">regionR_pt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">pt</span>, idx <span class="op">=</span> <span class="va">season</span>, accurate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Portugal"</span>, <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">regionR_pt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">percs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/quantile.html">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">regionR_pt</span><span class="op">)</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.70</span>, <span class="fl">0.90</span>, <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>
<span class="co"># Density plot with thresholds</span>
<span class="va">pdf_pt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_fire_pdf.html">plot_fire_pdf</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">regionR_pt</span>,
              thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span> <span class="st">"Portugal"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>,
              upper_limit <span class="op">=</span> <span class="fl">110</span>,
              v_lines <span class="op">=</span> <span class="va">percs</span><span class="op">)</span>
<span class="va">regionData</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">regionR_pt</span><span class="op">)</span><span class="op">)</span>
<span class="co">### Chile ###</span>
<span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_fire_season.html">get_fire_season</a></span><span class="op">(</span>dates <span class="op">=</span> <span class="va">dataDates</span>, zone <span class="op">=</span> <span class="st">"south"</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">regionR_chile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">chile</span>, idx <span class="op">=</span> <span class="va">season</span>, accurate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Chile"</span>, <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">regionR_chile</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">percs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/quantile.html">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">regionR_chile</span><span class="op">)</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.70</span>, <span class="fl">0.90</span>, <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>
<span class="co"># Density plot with thresholds</span>
<span class="va">pdf_chile</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_fire_pdf.html">plot_fire_pdf</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">regionR_chile</span>,
              thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span> <span class="st">"Chile"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>,
              upper_limit <span class="op">=</span> <span class="fl">110</span>,
              v_lines <span class="op">=</span> <span class="va">percs</span><span class="op">)</span>
<span class="va">regionData</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">regionR_chile</span><span class="op">)</span><span class="op">)</span>
<span class="co">### California ###</span>
<span class="va">season</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_fire_season.html">get_fire_season</a></span><span class="op">(</span>dates <span class="op">=</span> <span class="va">dataDates</span>, zone <span class="op">=</span> <span class="st">"north"</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">regionR_cali</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">cali</span>, idx <span class="op">=</span> <span class="va">season</span>, accurate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"California"</span>, <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">regionR_cali</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">percs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/quantile.html">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">regionR_cali</span><span class="op">)</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.70</span>, <span class="fl">0.90</span>, <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>
<span class="co"># Density plot with thresholds</span>
<span class="va">pdf_cali</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_fire_pdf.html">plot_fire_pdf</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">regionR_cali</span>,
              thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span> <span class="st">"California"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>,
              upper_limit <span class="op">=</span> <span class="fl">110</span>,
              v_lines <span class="op">=</span> <span class="va">percs</span><span class="op">)</span>
<span class="va">regionData</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">regionR_cali</span><span class="op">)</span><span class="op">)</span>

<span class="va">regionDF</span> <span class="op">&lt;-</span> <span class="fu">cbind.fill</span><span class="op">(</span><span class="va">regionData</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">regionData</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">regionData</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">regionDF</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Portugal"</span>, <span class="st">"Chile"</span>, <span class="st">"California"</span><span class="op">)</span>
<span class="co"># saveRDS(regionDF, "regionDF.rds")</span>
<span class="co"># saveRDS(df, "thresholds_geff.rds")</span>
<span class="co"># df &lt;- readRDS("thresholds_geff.rds")</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">df</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co"># ggsave(file = paste0(region, "PDF2.eps"),</span>
<span class="co">#        plot = listOfPlots[[i]], width=unit(8, "in"), height=unit(5, "in"))</span></code></pre></div>
</div>
<div id="daily-climatology-fire-danger-by-gfed4-areas-and-countries" class="section level2">
<h2 class="hasAnchor">
<a href="#daily-climatology-fire-danger-by-gfed4-areas-and-countries" class="anchor"></a>Daily climatology fire danger by GFED4 areas and countries</h2>
<p>Calculate daily climatology.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dclima</span> <span class="op">&lt;-</span> <span class="fu">caliver</span><span class="fu">::</span><span class="fu"><a href="../reference/daily_clima.html">daily_clima</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, probs <span class="op">=</span> <span class="fl">0.50</span><span class="op">)</span> <span class="co"># median</span>
<span class="va">dclima</span> <span class="op">&lt;-</span> <span class="va">dclima</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">59</span>,<span class="fl">61</span><span class="op">:</span><span class="fl">366</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="co"># Remove 29-02</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">dclima</span>, filename<span class="op">=</span><span class="st">'dclima_50.nc'</span>, format<span class="op">=</span><span class="st">"CDF"</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># dclima &lt;- brick("dclima_50.nc")</span></code></pre></div>
</div>
<div id="pod-by-gfed4-regions" class="section level2">
<h2 class="hasAnchor">
<a href="#pod-by-gfed4-regions" class="anchor"></a>POD by GFED4 regions</h2>
<p>It is interesting to try and understand whether there is a higher POD in some areas compared to others. In order to assess this, we proceed as follows:</p>
<ul>
<li>use the previously calculated regional thresholds</li>
<li>extract 1 year of forecasts (day 2 and 6 only)</li>
<li>for each forecast day we compare the forecasted fwi to the frp observed from satellites, adding also the climatology</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load thresholds</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"thresholds_geff.rds"</span><span class="op">)</span>

<span class="co"># Get forecasts for day 2-6-10</span>
<span class="va">day2FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">day6FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">day10FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">file</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/hugetmp/FireEventsDatabase/fwi2017/ffwi_rotated"</span>,
                        pattern <span class="op">=</span> <span class="st">"*hr.nc"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>
  <span class="va">day2FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">day2FWI</span>, <span class="va">x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">day6FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">day6FWI</span>, <span class="va">x</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">day10FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">day10FWI</span>, <span class="va">x</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Read in Fire Radiative Power (frp) and resample</span>
<span class="va">frp</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"/hugetmp/CAMS/CAMS_2017-01-01_2017-12-31_frpfire_rotated.nc"</span><span class="op">)</span>
<span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html">resample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">frp</span>, y <span class="op">=</span> <span class="va">day2FWI</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, progress <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span>

<span class="co"># Load clima, if not already in memory</span>
<span class="co"># dclima &lt;- brick("dclima_50.nc")</span>
<span class="co"># Resample clima</span>
<span class="va">dclimaR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html">resample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dclima</span>, y <span class="op">=</span> <span class="va">day2FWI</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, progress <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span>

<span class="va">POD2</span> <span class="op">&lt;-</span> <span class="va">POD6</span> <span class="op">&lt;-</span> <span class="va">POD10</span> <span class="op">&lt;-</span> <span class="va">climafire</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span><span class="op">{</span>

  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">df_gfed4</span><span class="op">$</span><span class="va">Region</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>

  <span class="va">areaOfInterest</span> <span class="op">&lt;-</span> <span class="va">BasisRegions</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>
  <span class="va">my_threshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">`Very high`</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">RegionCountry</span> <span class="op">==</span> <span class="va">df_gfed4</span><span class="op">$</span><span class="va">Region</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  
  <span class="va">frpM</span> <span class="op">&lt;-</span> <span class="fu">caliver</span><span class="fu">::</span><span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">frpR</span>, p <span class="op">=</span> <span class="va">areaOfInterest</span><span class="op">)</span>
  <span class="co">#day2FWIM &lt;- mask_crop_subset(r = day2FWI, p = areaOfInterest)</span>
  <span class="co">#day6FWIM &lt;- mask_crop_subset(r = day6FWI, p = areaOfInterest)</span>
  <span class="va">day10FWIM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">day10FWI</span>, p <span class="op">=</span> <span class="va">areaOfInterest</span><span class="op">)</span>
  <span class="va">clima_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">dclima</span>, p <span class="op">=</span> <span class="va">areaOfInterest</span><span class="op">)</span>
  
  <span class="va">frp_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">frpM</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>
  <span class="co">#day2_vector &lt;- as.vector(day2FWIM[])</span>
  <span class="co">#day6_vector &lt;- as.vector(day6FWIM[])</span>
  <span class="va">day10_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">day10FWIM</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>
  <span class="va">clima_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">clima_temp</span><span class="op">[</span><span class="op">]</span><span class="op">)</span>
  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">frp_vector</span> <span class="op">&gt;=</span> <span class="fl">0.5</span><span class="op">)</span>
  
  <span class="co"># Take only cells where there has been a large fire</span>
  <span class="va">frp_vector</span> <span class="op">&lt;-</span> <span class="va">frp_vector</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>
  <span class="co">#day2_vector &lt;- day2_vector[idx]</span>
  <span class="co">#day6_vector &lt;- day6_vector[idx]</span>
  <span class="va">day10_vector</span> <span class="op">&lt;-</span> <span class="va">day10_vector</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>
  <span class="va">clima_vector</span> <span class="op">&lt;-</span> <span class="va">clima_vector</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>

  <span class="va">frp_vector</span> <span class="op">&lt;-</span> <span class="va">frp_vector</span> <span class="op">&gt;=</span> <span class="fl">0.5</span>
  <span class="co">#day2_vector &lt;- day2_vector &gt;= my_threshold</span>
  <span class="co">#day6_vector &lt;- day6_vector &gt;= my_threshold</span>
  <span class="va">day10_vector</span> <span class="op">&lt;-</span> <span class="va">day10_vector</span> <span class="op">&gt;=</span> <span class="va">my_threshold</span>
  <span class="va">clima_vector</span> <span class="op">&lt;-</span> <span class="va">clima_vector</span> <span class="op">&gt;=</span> <span class="va">my_threshold</span>
  
  <span class="co">#POD2 &lt;- c(POD2, verify(obs = frp_vector, pred = day2_vector, frcst.type = "binary", obs.type = "binary")$POD)</span>
  
  <span class="co">#POD6 &lt;- c(POD6, verify(obs = frp_vector, pred = day6_vector, frcst.type = "binary", obs.type = "binary")$POD)</span>
  
  <span class="va">POD10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">POD10</span>, <span class="fu">verify</span><span class="op">(</span>obs <span class="op">=</span> <span class="va">frp_vector</span>, pred <span class="op">=</span> <span class="va">day10_vector</span>, frcst.type <span class="op">=</span> <span class="st">"binary"</span>, obs.type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span><span class="op">$</span><span class="va">POD</span><span class="op">)</span>

  <span class="va">climafire</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">climafire</span>, <span class="fu">verify</span><span class="op">(</span>obs <span class="op">=</span> <span class="va">frp_vector</span>, pred <span class="op">=</span> <span class="va">clima_vector</span>, 
                         frcst.type <span class="op">=</span> <span class="st">"binary"</span>, obs.type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span><span class="op">$</span><span class="va">POD</span><span class="op">)</span>
  
  <span class="co">#rm(areaOfInterest, my_threshold, frpM, day2FWIM, day6FWIM, frp_vector, day2_vector, day6_vector, idx)</span>
  <span class="co">#saveRDS(POD2, "POD2.rds")</span>
  <span class="co">#saveRDS(POD6, "POD6.rds")</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">POD10</span>, <span class="st">"POD10.rds"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">climafire</span>, <span class="st">"climafire.rds"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/gc.html">gc</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterTmpFile.html">removeTmpFiles</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># remove temp files</span>
<span class="op">}</span>
<span class="co"># POD2 &lt;- readRDS("POD2.rds")</span>
<span class="co"># POD6 &lt;- readRDS("POD6.rds")</span>
<span class="co"># POD10 &lt;- readRDS("POD10.rds")</span>
<span class="co"># climafire &lt;- readRDS("climafire.rds")</span>

<span class="va">regions.pod</span> <span class="op">&lt;-</span> <span class="va">BasisRegions</span> <span class="op">%&gt;%</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu">tidy</span><span class="op">(</span>region <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span> <span class="co"># to fix!</span>
<span class="co"># add attributes</span>
<span class="va">regions.pod</span><span class="op">$</span><span class="va">POD2</span> <span class="op">&lt;-</span> <span class="va">regions.pod</span><span class="op">$</span><span class="va">POD6</span> <span class="op">&lt;-</span> <span class="va">regions.pod</span><span class="op">$</span><span class="va">POD10</span> <span class="op">&lt;-</span> <span class="va">regions.pod</span><span class="op">$</span><span class="va">clima</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span><span class="op">{</span>
  <span class="va">regions.pod</span><span class="op">$</span><span class="va">POD2</span><span class="op">[</span><span class="va">regions.pod</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">POD2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="va">regions.pod</span><span class="op">$</span><span class="va">POD6</span><span class="op">[</span><span class="va">regions.pod</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">POD6</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="va">regions.pod</span><span class="op">$</span><span class="va">POD10</span><span class="op">[</span><span class="va">regions.pod</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">POD10</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="va">regions.pod</span><span class="op">$</span><span class="va">clima</span><span class="op">[</span><span class="va">regions.pod</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">climafire</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">regions.pod</span><span class="op">$</span><span class="va">POD2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">regions.pod</span><span class="op">$</span><span class="va">POD2</span>,
                           levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
                           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">regions.pod</span><span class="op">$</span><span class="va">POD6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">regions.pod</span><span class="op">$</span><span class="va">POD6</span>,
                           levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
                           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">regions.pod</span><span class="op">$</span><span class="va">POD10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">regions.pod</span><span class="op">$</span><span class="va">POD10</span>,
                           levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
                           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">regions.pod</span><span class="op">$</span><span class="va">clima</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">regions.pod</span><span class="op">$</span><span class="va">clima</span>,
                           levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
                           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill<span class="op">=</span><span class="cn">NA</span>, colour <span class="op">=</span> <span class="st">"grey65"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Longitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">regions.pod</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">as.factor</a></span><span class="op">(</span><span class="va">POD2</span><span class="op">)</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"POD2"</span>,
                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FFF7EC"</span>, <span class="st">"#FFF7EC"</span>, <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"OrRd"</span><span class="op">)</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill<span class="op">=</span><span class="cn">NA</span>, colour <span class="op">=</span> <span class="st">"grey65"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Longitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">regions.pod</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">POD6</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"POD6"</span>,
                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FFF7EC"</span>, <span class="st">"#FFF7EC"</span>, <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"OrRd"</span><span class="op">)</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill<span class="op">=</span><span class="cn">NA</span>, colour <span class="op">=</span> <span class="st">"grey65"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Longitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">regions.pod</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">POD10</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"POD10"</span>,
                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FFF7EC"</span>, <span class="st">"#FFF7EC"</span>, <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"OrRd"</span><span class="op">)</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill<span class="op">=</span><span class="cn">NA</span>, colour <span class="op">=</span> <span class="st">"grey65"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Longitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">regions.pod</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">clima</span><span class="op">)</span>,
               alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Climatology"</span>,
                    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FFF7EC"</span>, <span class="st">"#FFF7EC"</span>, <span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"OrRd"</span><span class="op">)</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="verify-fire-danger-classes" class="section level2">
<h2 class="hasAnchor">
<a href="#verify-fire-danger-classes" class="anchor"></a>Verify fire danger classes</h2>
<p>The following four events were selected to verify the previously calculated danger classes:</p>
<ul>
<li>Spain 2016-08-28 2016-09-11<br>
</li>
<li>Chile 2017-01-15 2017-01-29</li>
</ul>
<p>In order to find the actual area affected by fires (for each of the above events), we follow the steps below:</p>
<ol style="list-style-type: decimal">
<li>Get Fire Radiative Power from CAMS observations using the bash script <a href="https://software.ecmwf.int/stash/projects/CEMSF/repos/fire_utilities/browse/sh/CAMS_GFAS_Observations.sh">CAMS_GFAS_Observations.sh</a>: <code>sh CAMS_Observations.sh</code>. This generates the file: CAMS_<strong>TimeWindow</strong>_frpfire_rotated.nc</li>
<li>Load the file above as RasterBrick</li>
<li>Sum all the FRP over time</li>
<li>If there are many small fires, we can set a threshold of minimum radiative power to be considered. Convert layer info to binary: 1 if FRP &gt; 0.5, 0 otherwise</li>
<li>Plot to check maximum extension</li>
<li>Remove zeros and create a bounding box (fireBBOX) including only cells = 1</li>
</ol>
<p>Once the affected area has been identified, we use this to verify the forecast with the observed fire radiative power.</p>
<p>Forecast data is obtained by using the bash scripts: <a href="https://software.ecmwf.int/stash/projects/CEMSF/repos/fire_utilities/browse/sh/GEFF_Forecast.sh">GEFF_Forecast.sh</a>: <code>sh GEFF_Forecast.sh</code>. This generates one file per forecast day: <strong>start_date</strong>_<strong>end_date</strong>_ecfire_fwi_fwi.nc</p>
<p>The code below shows how to perform the verification for the 4 events.</p>
<div id="chile" class="section level4">
<h4 class="hasAnchor">
<a href="#chile" class="anchor"></a>Chile</h4>
<p>Numerous wildfire in Chile were reported in January 2017. In the table below we compare the danger levels at large scale and national level.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># GADM administrative boundaries</span>
<span class="va">Chile</span>     <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"Chile"</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="co"># 2. Load the frp file as RasterBrick:</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-01-01"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-01-31"</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/hugetmp/fire/CAMS/CAMS_"</span>,
                          <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># 3. Sum all the FRP over time</span>
<span class="va">xsum</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/calc.html">calc</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">sum</span><span class="op">)</span>

<span class="co"># 4. Convert layer info to binary: 1 if FRP &gt; 0.5, 0 otherwise</span>
<span class="va">thresholdFRP</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>
<span class="va">xsum</span><span class="op">[</span><span class="va">xsum</span> <span class="op">&gt;</span> <span class="va">thresholdFRP</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">xsum</span><span class="op">[</span><span class="va">xsum</span> <span class="op">&lt;=</span> <span class="va">thresholdFRP</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># extra step to plot pixels &lt;= 0.5 as gray background</span>
<span class="va">allFires</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">xsum</span>, p <span class="op">=</span> <span class="va">Chile</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, crop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">allFires</span><span class="op">)</span>

<span class="co"># 5-6. Remove zeros and create a bounding box including only cells = 1</span>
<span class="va">xsum</span><span class="op">[</span><span class="va">xsum</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">fireBBOX</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/trim.html">trim</a></span><span class="op">(</span><span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">xsum</span>, 
                                                       p <span class="op">=</span> <span class="va">Chile</span>, 
                                                       mask <span class="op">=</span> <span class="cn">TRUE</span>, 
                                                       crop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
               <span class="st">"SpatialPolygons"</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">fireBBOX</span>, border <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">fireBBOX_CL</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">74</span>, <span class="op">-</span><span class="fl">70</span>, <span class="op">-</span><span class="fl">37</span>, <span class="op">-</span><span class="fl">33</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>
<span class="co"># raster::plot(Chile, col = "lightgray")</span>
<span class="co"># raster::plot(fireBBOX_CL, lwd = 2, border = "red", add = TRUE)</span></code></pre></div>
<p><img src="figures/Chile_boxy_map.png" width="700"></p>
<p>In the figure above Chile is shaded in gray while the areas in green show the most important fire activities(fireBBOX), which we compare below with the high danger level calculated previously for Chile.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ChileFRP</span> <span class="op">&lt;-</span> <span class="fu">plot_obs_vs_forecast</span><span class="op">(</span>input_dir <span class="op">=</span> <span class="st">"../geff/forecast/fwi2017/ffwi_rotated"</span>, 
                                 p <span class="op">=</span> <span class="va">fireBBOX_CL</span>, 
                                 threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">`Very high`</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="st">"Chile"</span><span class="op">]</span><span class="op">)</span>,
                                 start_date <span class="op">=</span> <span class="va">start_date</span>,
                                 end_date <span class="op">=</span> <span class="va">end_date</span>,
                                 obs_file_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/hugetmp/fire/CAMS/CAMS_"</span>, <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span>,
                                 forecast_type <span class="op">=</span> <span class="st">"hr"</span>,
                                 origin <span class="op">=</span> <span class="st">"cfwis"</span>,
                                 index <span class="op">=</span> <span class="st">"ffwi"</span><span class="op">)</span>
<span class="va">ChileFRP</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"/scratch/mo/moc0/fire/ChileFRP.png"</span>,
       plot <span class="op">=</span> <span class="va">ChileFRP</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1050</span>, <span class="st">"px"</span><span class="op">)</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">750</span>, <span class="st">"px"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="portugal" class="section level4">
<h4 class="hasAnchor">
<a href="#portugal" class="anchor"></a>Portugal</h4>
<p>Numerous wildfire in Portugal were reported in January 2017. In the table below we compare the danger levels at large scale and national level.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># GADM administrative boundary</span>
<span class="va">Portugal</span>     <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"Portugal"</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="co"># 2. Load the frp file as RasterBrick:</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-06-01"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-06-30"</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/hugetmp/fire/CAMS/CAMS_"</span>,
                          <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># 3. Sum all the FRP over time</span>
<span class="va">xsum</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/calc.html">calc</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">sum</span><span class="op">)</span>

<span class="co"># 4. Convert layer info to binary: 1 if FRP &gt; 0.5, 0 otherwise</span>
<span class="va">thresholdFRP</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>
<span class="va">xsum</span><span class="op">[</span><span class="va">xsum</span> <span class="op">&gt;</span> <span class="va">thresholdFRP</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">xsum</span><span class="op">[</span><span class="va">xsum</span> <span class="op">&lt;=</span> <span class="va">thresholdFRP</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># extra step to plot pixels &lt;= 0.5 as gray background</span>
<span class="va">allFires</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">xsum</span>, p <span class="op">=</span> <span class="va">Portugal</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, crop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">allFires</span><span class="op">)</span>

<span class="co"># 5-6. Remove zeros and create a bounding box including only cells = 1</span>
<span class="va">xsum</span><span class="op">[</span><span class="va">xsum</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">fireBBOX</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/trim.html">trim</a></span><span class="op">(</span><span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">xsum</span>, 
                                                       p <span class="op">=</span> <span class="va">Portugal</span>, 
                                                       mask <span class="op">=</span> <span class="cn">TRUE</span>, 
                                                       crop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
               <span class="st">"SpatialPolygons"</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">fireBBOX</span>, border <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">fireBBOX_CL</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8.5</span>, <span class="op">-</span><span class="fl">7.6</span>, <span class="fl">39.6</span>, <span class="fl">40.3</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>
<span class="co"># raster::plot(Portugal, col = "lightgray")</span>
<span class="co"># raster::plot(fireBBOX_CL, lwd = 2, border = "red", add = TRUE)</span></code></pre></div>
<p><img src="figures/Portugal_boxy_map.png" width="700"></p>
<p>In the figure above Portugal is shaded in gray while the areas in green show the most important fire activities(fireBBOX), which we compare below with the high danger level calculated previously for Portugal.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PortugalFRP</span> <span class="op">&lt;-</span> <span class="fu">plot_obs_vs_forecast</span><span class="op">(</span>input_dir <span class="op">=</span> <span class="st">"../geff/forecast/fwi2017/ffwi_rotated"</span>, 
                                 p <span class="op">=</span> <span class="va">fireBBOX_CL</span>, 
                                 threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">`Very high`</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="st">"Portugal"</span><span class="op">]</span><span class="op">)</span>,
                                 start_date <span class="op">=</span> <span class="va">start_date</span>,
                                 end_date <span class="op">=</span> <span class="va">end_date</span>,
                                 obs_file_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/hugetmp/fire/CAMS/CAMS_"</span>, <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span>, forecast_type <span class="op">=</span> <span class="st">"hr"</span>, origin <span class="op">=</span> <span class="st">"cfwis"</span>, index <span class="op">=</span> <span class="st">"ffwi"</span><span class="op">)</span>
<span class="va">PortugalFRP</span></code></pre></div>
</div>
<div id="california" class="section level4">
<h4 class="hasAnchor">
<a href="#california" class="anchor"></a>California</h4>
<p>Numerous wildfire in California were reported in January 2017. In the table below we compare the danger levels at large scale and national level.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># GADM administrative boundaries</span>
<span class="va">California</span>    <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"USA"</span>, level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span>,<span class="op">]</span>

<span class="co"># 2. Load the frp file as RasterBrick:</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-09-21"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-10-20"</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/hugetmp/fire/CAMS/CAMS_"</span>,
                          <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># 3. Sum all the FRP over time</span>
<span class="va">xsum</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/calc.html">calc</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">sum</span><span class="op">)</span>

<span class="co"># 4. Convert layer info to binary: 1 if FRP &gt; 0.5, 0 otherwise</span>
<span class="va">thresholdFRP</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>
<span class="va">xsum</span><span class="op">[</span><span class="va">xsum</span> <span class="op">&gt;</span> <span class="va">thresholdFRP</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">xsum</span><span class="op">[</span><span class="va">xsum</span> <span class="op">&lt;=</span> <span class="va">thresholdFRP</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span> <span class="co"># extra step to plot pixels &lt;= 0.5 as gray background</span>
<span class="va">allFires</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">xsum</span>, p <span class="op">=</span> <span class="va">California</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, crop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">allFires</span><span class="op">)</span>

<span class="co"># 5-6. Remove zeros and create a bounding box including only cells = 1</span>
<span class="va">xsum</span><span class="op">[</span><span class="va">xsum</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">fireBBOX</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/trim.html">trim</a></span><span class="op">(</span><span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">xsum</span>, 
                                                       p <span class="op">=</span> <span class="va">California</span>, 
                                                       mask <span class="op">=</span> <span class="cn">TRUE</span>, 
                                                       crop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
               <span class="st">"SpatialPolygons"</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">fireBBOX</span>, border <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">fireBBOX</span>
<span class="va">fireBBOX_CL</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">123.4</span>, <span class="op">-</span><span class="fl">117.6</span>, <span class="fl">33.7</span>, <span class="fl">42</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>
<span class="co"># raster::plot(California, col = "lightgray")</span>
<span class="co"># raster::plot(fireBBOX_CL, lwd = 2, border = "red", add = TRUE)</span></code></pre></div>
<p><img src="figures/California_boxy_map.png" width="700"></p>
<p>In the figure above California is shaded in gray while the areas in green show the most important fire activities(fireBBOX), which we compare below with the high danger level calculated previously for California.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CaliforniaFRP</span> <span class="op">&lt;-</span> <span class="fu">plot_obs_vs_forecast</span><span class="op">(</span>input_dir <span class="op">=</span> <span class="st">"../geff/forecast/fwi2017/ffwi_rotated"</span>, 
                                 p <span class="op">=</span> <span class="va">fireBBOX_CL</span>, 
                                 threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">`Very high`</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="st">"California"</span><span class="op">]</span><span class="op">)</span>,
                                 start_date <span class="op">=</span> <span class="va">start_date</span>,
                                 end_date <span class="op">=</span> <span class="va">end_date</span>,
                                 obs_file_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/hugetmp/fire/CAMS/CAMS_"</span>, <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span>, forecast_type <span class="op">=</span> <span class="st">"hr"</span>, origin <span class="op">=</span> <span class="st">"cfwis"</span>, index <span class="op">=</span> <span class="st">"ffwi"</span><span class="op">)</span>
<span class="va">CaliforniaFRP</span></code></pre></div>
</div>
</div>
<div id="scores" class="section level2">
<h2 class="hasAnchor">
<a href="#scores" class="anchor"></a>Scores</h2>
<p>Let’s take a large area, such as Canada. The advantage of using the above danger levels over the continuous values is that we have a better correspondance between hit rate and false alarms.</p>
<p>For the fire in Canada, the peak in radiative power was obtained on the 2015-06-16. To calculate the scores I need to collect the forecasts of the previous 10 days and compare fwi and frp.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">place</span> <span class="op">&lt;-</span> <span class="st">"Chile"</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-01-01"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-01-31"</span>
<span class="va">eventDay</span> <span class="op">&lt;-</span> <span class="fl">26</span>

<span class="va">areaOfInterest</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">74</span>, <span class="op">-</span><span class="fl">70</span>, <span class="op">-</span><span class="fl">37</span>, <span class="op">-</span><span class="fl">33</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>

<span class="va">mydays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">end_date</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"days"</span><span class="op">)</span><span class="op">[</span><span class="op">(</span><span class="va">eventDay</span><span class="op">-</span><span class="fl">9</span><span class="op">)</span><span class="op">:</span><span class="va">eventDay</span><span class="op">]</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"thresholds_geff.rds"</span><span class="op">)</span>
<span class="va">my_threshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">`Very high`</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="va">place</span><span class="op">]</span><span class="op">)</span>

<span class="co"># Extract frp only once (for the event day)</span>
<span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"../CAMS/CAMS_"</span>, <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="va">eventDay</span><span class="op">]</span><span class="op">]</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">@</span><span class="va">extent</span><span class="op">@</span><span class="va">xmin</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">)</span>
<span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">frpR</span>, p <span class="op">=</span> <span class="va">areaOfInterest</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, crop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">frp_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">)</span>
<span class="va">frp_v</span><span class="op">[</span><span class="va">frp_v</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
<span class="va">frp_v</span><span class="op">[</span><span class="va">frp_v</span> <span class="op">&gt;=</span> <span class="fl">0.5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="co"># Extract ENS + HRES and calculate POD distribution for given area</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">newdate</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">newdate</span><span class="op">)</span>
  <span class="va">myFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../geff/forecast/fwi2017/ffwi_rotated"</span>,
                        pattern <span class="op">=</span> <span class="va">newdate</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">myFiles</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"member"</span>, <span class="va">j</span><span class="op">)</span><span class="op">)</span>
    <span class="va">singlefile</span> <span class="op">&lt;-</span> <span class="va">myFiles</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
    <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">singlefile</span><span class="op">)</span><span class="op">[[</span><span class="fl">11</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">@</span><span class="va">extent</span><span class="op">@</span><span class="va">xmin</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">)</span>
    <span class="va">fwi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">fwiR</span>, p <span class="op">=</span> <span class="va">areaOfInterest</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, crop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
    <span class="va">fwi</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html">resample</a></span><span class="op">(</span><span class="va">fwi</span>, <span class="va">frpR</span>, progress <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span>
    <span class="va">fwi_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">fwi</span><span class="op">)</span>
    <span class="va">fwi_v</span><span class="op">[</span><span class="va">fwi_v</span> <span class="op">&lt;</span> <span class="va">my_threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
    <span class="va">fwi_v</span><span class="op">[</span><span class="va">fwi_v</span> <span class="op">&gt;=</span> <span class="va">my_threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
    <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu">verify</span><span class="op">(</span>obs <span class="op">=</span> <span class="va">frp_v</span>, pred <span class="op">=</span> <span class="va">fwi_v</span>,
                frcst.type <span class="op">=</span> <span class="st">"binary"</span>, obs.type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span>
    <span class="va">y</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">A</span><span class="op">$</span><span class="va">POD</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">y</span><span class="op">$</span><span class="va">Day</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">:</span><span class="fl">1</span>
<span class="va">ensDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">51</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fcDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">52</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ensDF</span>, <span class="st">"Chile_ensDF.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">fcDF</span>, <span class="st">"Chile_hresDF.rds"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># box plot of cf + pf1-50</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ensDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Day</span><span class="op">)</span>, y<span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># points of fc</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fcDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Day</span><span class="op">)</span>, y<span class="op">=</span><span class="va">value</span>, color <span class="op">=</span> <span class="st">"HRES"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"POD"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">#ggtitle("POD of fire in Chile Jan 2017, danger &gt; very high level") + </span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">place</span> <span class="op">&lt;-</span> <span class="st">"Portugal"</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-06-01"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-06-30"</span>
<span class="va">eventDay</span> <span class="op">&lt;-</span> <span class="fl">18</span>

<span class="va">areaOfInterest</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8.5</span>, <span class="op">-</span><span class="fl">7.6</span>, <span class="fl">39.6</span>, <span class="fl">40.3</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>

<span class="va">mydays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">end_date</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"days"</span><span class="op">)</span><span class="op">[</span><span class="op">(</span><span class="va">eventDay</span><span class="op">-</span><span class="fl">9</span><span class="op">)</span><span class="op">:</span><span class="va">eventDay</span><span class="op">]</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"thresholds_geff.rds"</span><span class="op">)</span>
<span class="va">my_threshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">`Very high`</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="va">place</span><span class="op">]</span><span class="op">)</span>

<span class="co"># Extract frp only once (for the event day)</span>
<span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"../CAMS/CAMS_"</span>, <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="va">eventDay</span><span class="op">]</span><span class="op">]</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">@</span><span class="va">extent</span><span class="op">@</span><span class="va">xmin</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">)</span>
<span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">frpR</span>, p <span class="op">=</span> <span class="va">areaOfInterest</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, crop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">frp_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">)</span>
<span class="va">frp_v</span><span class="op">[</span><span class="va">frp_v</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
<span class="va">frp_v</span><span class="op">[</span><span class="va">frp_v</span> <span class="op">&gt;=</span> <span class="fl">0.5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="co"># Extract ENS + HRES and calculate POD distribution for given area</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">newdate</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">newdate</span><span class="op">)</span>
  <span class="va">myFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../geff/forecast/fwi2017/ffwi_rotated"</span>,
                        pattern <span class="op">=</span> <span class="va">newdate</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">myFiles</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"member"</span>, <span class="va">j</span><span class="op">)</span><span class="op">)</span>
    <span class="va">singlefile</span> <span class="op">&lt;-</span> <span class="va">myFiles</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
    <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">singlefile</span><span class="op">)</span><span class="op">[[</span><span class="fl">11</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">@</span><span class="va">extent</span><span class="op">@</span><span class="va">xmin</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">)</span>
    <span class="va">fwi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">fwiR</span>, p <span class="op">=</span> <span class="va">areaOfInterest</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, crop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
    <span class="va">fwi</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html">resample</a></span><span class="op">(</span><span class="va">fwi</span>, <span class="va">frpR</span>, progress <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span>
    <span class="va">fwi_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">fwi</span><span class="op">)</span>
    <span class="va">fwi_v</span><span class="op">[</span><span class="va">fwi_v</span> <span class="op">&lt;</span> <span class="va">my_threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
    <span class="va">fwi_v</span><span class="op">[</span><span class="va">fwi_v</span> <span class="op">&gt;=</span> <span class="va">my_threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
    <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu">verify</span><span class="op">(</span>obs <span class="op">=</span> <span class="va">frp_v</span>, pred <span class="op">=</span> <span class="va">fwi_v</span>,
                frcst.type <span class="op">=</span> <span class="st">"binary"</span>, obs.type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span>
    <span class="va">y</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">A</span><span class="op">$</span><span class="va">POD</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">y</span><span class="op">$</span><span class="va">Day</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">:</span><span class="fl">1</span>
<span class="va">ensDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">51</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fcDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">52</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ensDF</span>, <span class="st">"Portugal_ensDF.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">fcDF</span>, <span class="st">"Portugal_hresDF.rds"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># box plot of cf + pf1-50</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ensDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Day</span><span class="op">)</span>, y<span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># points of fc</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fcDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Day</span><span class="op">)</span>, y<span class="op">=</span><span class="va">value</span>, color <span class="op">=</span> <span class="st">"HRES"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"POD"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">place</span> <span class="op">&lt;-</span> <span class="st">"California"</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-09-21"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-10-20"</span>
<span class="va">eventDay</span> <span class="op">&lt;-</span> <span class="fl">19</span>

<span class="va">areaOfInterest</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">123.4</span>, <span class="op">-</span><span class="fl">117.6</span>, <span class="fl">33.7</span>, <span class="fl">42</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>

<span class="va">mydays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">end_date</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"days"</span><span class="op">)</span><span class="op">[</span><span class="op">(</span><span class="va">eventDay</span><span class="op">-</span><span class="fl">9</span><span class="op">)</span><span class="op">:</span><span class="va">eventDay</span><span class="op">]</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"thresholds_geff.rds"</span><span class="op">)</span>
<span class="va">my_threshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">`Very high`</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="va">place</span><span class="op">]</span><span class="op">)</span>

<span class="co"># Extract frp only once (for the event day)</span>
<span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"../CAMS/CAMS_"</span>, <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="va">eventDay</span><span class="op">]</span><span class="op">]</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">@</span><span class="va">extent</span><span class="op">@</span><span class="va">xmin</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">)</span>
<span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">frpR</span>, p <span class="op">=</span> <span class="va">areaOfInterest</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, crop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">frp_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">)</span>
<span class="va">frp_v</span><span class="op">[</span><span class="va">frp_v</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
<span class="va">frp_v</span><span class="op">[</span><span class="va">frp_v</span> <span class="op">&gt;=</span> <span class="fl">0.5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="co"># Extract ENS + HRES and calculate POD distribution for given area</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">newdate</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">newdate</span><span class="op">)</span>
  <span class="va">myFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../geff/forecast/fwi2017/ffwi_rotated"</span>,
                        pattern <span class="op">=</span> <span class="va">newdate</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">myFiles</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"member"</span>, <span class="va">j</span><span class="op">)</span><span class="op">)</span>
    <span class="va">singlefile</span> <span class="op">&lt;-</span> <span class="va">myFiles</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
    <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">singlefile</span><span class="op">)</span><span class="op">[[</span><span class="fl">11</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">@</span><span class="va">extent</span><span class="op">@</span><span class="va">xmin</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">)</span>
    <span class="va">fwi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">fwiR</span>, p <span class="op">=</span> <span class="va">areaOfInterest</span>, mask <span class="op">=</span> <span class="cn">TRUE</span>, crop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
    <span class="va">fwi</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html">resample</a></span><span class="op">(</span><span class="va">fwi</span>, <span class="va">frpR</span>, progress <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span>
    <span class="va">fwi_v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.vector</a></span><span class="op">(</span><span class="va">fwi</span><span class="op">)</span>
    <span class="va">fwi_v</span><span class="op">[</span><span class="va">fwi_v</span> <span class="op">&lt;</span> <span class="va">my_threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
    <span class="va">fwi_v</span><span class="op">[</span><span class="va">fwi_v</span> <span class="op">&gt;=</span> <span class="va">my_threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
    <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu">verify</span><span class="op">(</span>obs <span class="op">=</span> <span class="va">frp_v</span>, pred <span class="op">=</span> <span class="va">fwi_v</span>,
                frcst.type <span class="op">=</span> <span class="st">"binary"</span>, obs.type <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span>
    <span class="va">y</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">A</span><span class="op">$</span><span class="va">POD</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">y</span><span class="op">$</span><span class="va">Day</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">:</span><span class="fl">1</span>
<span class="va">ensDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">51</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fcDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">52</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ensDF</span>, <span class="st">"California_ensDF.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">fcDF</span>, <span class="st">"California_hresDF.rds"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># box plot of cf + pf1-50</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ensDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Day</span><span class="op">)</span>, y<span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># points of fc</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fcDF</span>, 
             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Day</span><span class="op">)</span>, y<span class="op">=</span><span class="va">value</span>, color <span class="op">=</span> <span class="st">"HRES"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"POD"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="fwi-and-ens" class="section level2">
<h2 class="hasAnchor">
<a href="#fwi-and-ens" class="anchor"></a>FWI and ENS</h2>
<p>Let’s take a large area, such as Canada. The advantage of using the above danger levels over the continuous values is that we have a better correspondance between hit rate and false alarms.</p>
<p>For the fire in Canada, the peak in radiative power was obtained on the 2015-06-16. To calculate the scores I need to collect the forecasts of the previous 10 days and compare fwi and frp.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">place</span> <span class="op">&lt;-</span> <span class="st">"Chile"</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-01-01"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-01-31"</span>
<span class="va">eventDay</span> <span class="op">&lt;-</span> <span class="fl">26</span>

<span class="va">areaOfInterest</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">74</span>, <span class="op">-</span><span class="fl">70</span>, <span class="op">-</span><span class="fl">37</span>, <span class="op">-</span><span class="fl">33</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>

<span class="va">mydays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">end_date</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"days"</span><span class="op">)</span><span class="op">[</span><span class="op">(</span><span class="va">eventDay</span><span class="op">-</span><span class="fl">9</span><span class="op">)</span><span class="op">:</span><span class="va">eventDay</span><span class="op">]</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"thresholds_geff.rds"</span><span class="op">)</span>

<span class="co"># Extract frp only once (for the event day)</span>
<span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"../CAMS/CAMS_"</span>, <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="va">eventDay</span><span class="op">]</span><span class="op">]</span>

<span class="va">eventLocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPoints</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="op">-</span><span class="fl">72.35</span>, lat <span class="op">=</span> <span class="op">-</span><span class="fl">35.55</span><span class="op">)</span>,
                   proj4string <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">frpR</span> , <span class="va">areaOfInterest</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">eventLocation</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">frpR</span>, y <span class="op">=</span> <span class="va">eventLocation</span><span class="op">)</span>

<span class="co"># Extract ENS + HRES and calculate POD distribution for given area</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">newdate</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">newdate</span><span class="op">)</span>
  <span class="va">myFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../geff/forecast/fwi2017/ffwi_rotated"</span>,
                        pattern <span class="op">=</span> <span class="va">newdate</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">myFiles</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"member"</span>, <span class="va">j</span><span class="op">)</span><span class="op">)</span>
    <span class="va">singlefile</span> <span class="op">&lt;-</span> <span class="va">myFiles</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
    <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">singlefile</span><span class="op">)</span><span class="op">[[</span><span class="fl">11</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">@</span><span class="va">extent</span><span class="op">@</span><span class="va">xmin</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">)</span>
    <span class="va">y</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fwiR</span>, y <span class="op">=</span> <span class="va">eventLocation</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">y</span><span class="op">$</span><span class="va">Day</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">:</span><span class="fl">1</span>
<span class="va">ensDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">51</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fcDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">52</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ensDF</span>, <span class="st">"Chile_ensDFfwi.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">fcDF</span>, <span class="st">"Chile_hresDFfwi.rds"</span><span class="op">)</span>

<span class="va">dfFWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>fwi1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="va">place</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
                    fwi2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="va">place</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span>,
                    Danger <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Very low"</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="va">dfFWI</span><span class="op">$</span><span class="va">Danger</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dfFWI</span><span class="op">$</span><span class="va">Danger</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Very low"</span>, <span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>, <span class="st">"Very high"</span>, <span class="st">"Extreme"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># ENSfwi</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dfFWI</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">fwi1</span>, ymax <span class="op">=</span> <span class="va">fwi2</span>, xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">11</span>, fill <span class="op">=</span> <span class="va">Danger</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># box plot of cf + pf1-50</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ensDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y<span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">Day</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># points of fc</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fcDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y<span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">Day</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"coral"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co">#theme(legend.title=element_blank()) +</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"FWI"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">11</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">place</span> <span class="op">&lt;-</span> <span class="st">"Portugal"</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-06-01"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-06-30"</span>
<span class="va">eventDay</span> <span class="op">&lt;-</span> <span class="fl">18</span>

<span class="va">areaOfInterest</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8.5</span>, <span class="op">-</span><span class="fl">7.6</span>, <span class="fl">39.6</span>, <span class="fl">40.3</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>

<span class="va">mydays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">end_date</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"days"</span><span class="op">)</span><span class="op">[</span><span class="op">(</span><span class="va">eventDay</span><span class="op">-</span><span class="fl">9</span><span class="op">)</span><span class="op">:</span><span class="va">eventDay</span><span class="op">]</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"thresholds_geff.rds"</span><span class="op">)</span>

<span class="co"># Extract frp only once (for the event day)</span>
<span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"../CAMS/CAMS_"</span>, <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="va">eventDay</span><span class="op">]</span><span class="op">]</span>

<span class="va">eventLocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPoints</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="op">-</span><span class="fl">8.25</span>, lat <span class="op">=</span> <span class="fl">39.85</span><span class="op">)</span>,
                   proj4string <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">frpR</span> , <span class="va">areaOfInterest</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">eventLocation</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">frpR</span>, y <span class="op">=</span> <span class="va">eventLocation</span><span class="op">)</span>

<span class="co"># Extract ENS + HRES and calculate POD distribution for given area</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">newdate</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">newdate</span><span class="op">)</span>
  <span class="va">myFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../geff/forecast/fwi2017/ffwi_rotated"</span>,
                        pattern <span class="op">=</span> <span class="va">newdate</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">myFiles</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"member"</span>, <span class="va">j</span><span class="op">)</span><span class="op">)</span>
    <span class="va">singlefile</span> <span class="op">&lt;-</span> <span class="va">myFiles</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
    <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">singlefile</span><span class="op">)</span><span class="op">[[</span><span class="fl">11</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">@</span><span class="va">extent</span><span class="op">@</span><span class="va">xmin</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">)</span>
    <span class="va">y</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fwiR</span>, y <span class="op">=</span> <span class="va">eventLocation</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">y</span><span class="op">$</span><span class="va">Day</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">:</span><span class="fl">1</span>
<span class="va">ensDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">51</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fcDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">52</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ensDF</span>, <span class="st">"Portugal_ensDFfwi.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">fcDF</span>, <span class="st">"Portugal_hresDFfwi.rds"</span><span class="op">)</span>

<span class="va">dfFWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>fwi1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="va">place</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
                    fwi2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="va">place</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span>,
                    Danger <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Very low"</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="va">dfFWI</span><span class="op">$</span><span class="va">Danger</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dfFWI</span><span class="op">$</span><span class="va">Danger</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Very low"</span>, <span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>, <span class="st">"Very high"</span>, <span class="st">"Extreme"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># ENSfwi</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dfFWI</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">fwi1</span>, ymax <span class="op">=</span> <span class="va">fwi2</span>, xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">11</span>, fill <span class="op">=</span> <span class="va">Danger</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># box plot of cf + pf1-50</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ensDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y<span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">Day</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># points of fc</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fcDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y<span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">Day</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"coral"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co">#theme(legend.title=element_blank()) +</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"FWI"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">11</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">place</span> <span class="op">&lt;-</span> <span class="st">"California"</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-09-21"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-10-20"</span>
<span class="va">eventDay</span> <span class="op">&lt;-</span> <span class="fl">19</span>

<span class="va">areaOfInterest</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">123.4</span>, <span class="op">-</span><span class="fl">117.6</span>, <span class="fl">33.7</span>, <span class="fl">42</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>

<span class="va">mydays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">end_date</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"days"</span><span class="op">)</span><span class="op">[</span><span class="op">(</span><span class="va">eventDay</span><span class="op">-</span><span class="fl">9</span><span class="op">)</span><span class="op">:</span><span class="va">eventDay</span><span class="op">]</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"thresholds_geff.rds"</span><span class="op">)</span>

<span class="co"># Extract frp only once (for the event day)</span>
<span class="va">frpR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"../CAMS/CAMS_"</span>, <span class="va">start_date</span>, <span class="st">"_"</span>, <span class="va">end_date</span>, <span class="st">"_frpfire_rotated.nc"</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="va">eventDay</span><span class="op">]</span><span class="op">]</span>

<span class="va">eventLocation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPoints</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="op">-</span><span class="fl">122.65</span>, lat <span class="op">=</span> <span class="fl">38.55</span><span class="op">)</span>,
                   proj4string <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">frpR</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">frpR</span> , <span class="va">areaOfInterest</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">eventLocation</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">frpR</span>, y <span class="op">=</span> <span class="va">eventLocation</span><span class="op">)</span>

<span class="co"># Extract ENS + HRES and calculate POD distribution for given area</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">newdate</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">newdate</span><span class="op">)</span>
  <span class="va">myFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../geff/forecast/fwi2017/ffwi_rotated"</span>,
                        pattern <span class="op">=</span> <span class="va">newdate</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">myFiles</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"member"</span>, <span class="va">j</span><span class="op">)</span><span class="op">)</span>
    <span class="va">singlefile</span> <span class="op">&lt;-</span> <span class="va">myFiles</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
    <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">singlefile</span><span class="op">)</span><span class="op">[[</span><span class="fl">11</span><span class="op">-</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">@</span><span class="va">extent</span><span class="op">@</span><span class="va">xmin</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">fwiR</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">fwiR</span><span class="op">)</span>
    <span class="va">y</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fwiR</span>, y <span class="op">=</span> <span class="va">eventLocation</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">y</span><span class="op">$</span><span class="va">Day</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">:</span><span class="fl">1</span>
<span class="va">ensDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">51</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="va">fcDF</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">52</span>, <span class="fl">53</span><span class="op">)</span><span class="op">]</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ensDF</span>, <span class="st">"California_ensDFfwi.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">fcDF</span>, <span class="st">"California_hresDFfwi.rds"</span><span class="op">)</span>

<span class="va">dfFWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>fwi1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="va">place</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
                    fwi2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">Location</span> <span class="op">==</span> <span class="va">place</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span>,
                    Danger <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Very low"</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="va">dfFWI</span><span class="op">$</span><span class="va">Danger</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dfFWI</span><span class="op">$</span><span class="va">Danger</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Very low"</span>, <span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>, <span class="st">"Very high"</span>, <span class="st">"Extreme"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># ENSfwi</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dfFWI</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">fwi1</span>, ymax <span class="op">=</span> <span class="va">fwi2</span>,
                                        xmin <span class="op">=</span> <span class="fl">0</span>, xmax <span class="op">=</span> <span class="fl">11</span>,
                                        fill <span class="op">=</span> <span class="va">Danger</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># box plot of cf + pf1-50</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ensDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y<span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">Day</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># points of fc</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fcDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y<span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">Day</span><span class="op">)</span>,
             size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"coral"</span><span class="op">)</span> <span class="op">+</span> 
  
  <span class="co">#theme(legend.title=element_blank()) +</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Day"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"FWI"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">11</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="compare-with-synop---portugal-only" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-with-synop---portugal-only" class="anchor"></a>Compare with SYNOP - Portugal only</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"/hugetmp/datadescriptor/stations.rds"</span><span class="op">)</span>
<span class="va">allIDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"/hugetmp/datadescriptor/allIDs.rds"</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"/hugetmp/datadescriptor/variablesDF.rds"</span><span class="op">)</span>

<span class="va">pt</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"PT"</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9.71</span>,<span class="op">-</span><span class="fl">6.19</span>,<span class="fl">36.62</span>, <span class="fl">42.15</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">st</span><span class="op">)</span>
<span class="va">stPT</span> <span class="op">&lt;-</span> <span class="va">st</span><span class="op">[</span><span class="va">bbox</span>, <span class="op">]</span>
<span class="va">stPT</span> <span class="op">&lt;-</span> <span class="va">stPT</span><span class="op">[</span><span class="va">pt</span>, <span class="op">]</span>
<span class="va">stPT</span> <span class="op">&lt;-</span> <span class="va">stPT</span><span class="op">[</span><span class="va">stPT</span><span class="op">$</span><span class="va">id</span> <span class="op">%in%</span> <span class="va">allIDs</span>, <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">pt</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">stPT</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">id</span> <span class="op">%in%</span> <span class="va">stPT</span><span class="op">$</span><span class="va">id</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">mon</span> <span class="op">==</span> <span class="fl">6</span>, <span class="op">]</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">id</span><span class="op">)</span> <span class="op">==</span> <span class="fl">30</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span>
<span class="va">stPT</span> <span class="op">&lt;-</span> <span class="va">stPT</span><span class="op">[</span><span class="va">stPT</span><span class="op">$</span><span class="va">id</span> <span class="op">%in%</span> <span class="va">df</span><span class="op">$</span><span class="va">id</span>, <span class="op">]</span>

<span class="co"># FROM REANALYSIS</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">fwiobs</span>, y <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">fwimod_re</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">fwiobs</span><span class="op">~</span><span class="va">fwimod_re</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span>

<span class="co"># GET FORECASTS</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-06-01"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-06-30"</span>
<span class="va">mydays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">end_date</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"days"</span><span class="op">)</span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">newdate</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">newdate</span><span class="op">)</span>
  <span class="va">myFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/hugetmp/fire/geff/forecast/fwi2017/ffwi_rotated"</span>,
                        pattern <span class="op">=</span> <span class="va">newdate</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">myFiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mydays</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html">writeRaster</a></span><span class="op">(</span><span class="va">s</span>, filename <span class="op">=</span> <span class="st">"fwi2017rt.nc"</span>, format <span class="op">=</span> <span class="st">"CDF"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">fwimod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">stPT</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html">nlayers</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">fwimod</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"day"</span>, <span class="st">"fwimod"</span><span class="op">)</span>
<span class="va">fwimod</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">stPT</span><span class="op">$</span><span class="va">id</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html">nlayers</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">)</span>
<span class="va">fwimod</span><span class="op">$</span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/nlayers.html">nlayers</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">stPT</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">stPT</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">j</span><span class="op">)</span>
  <span class="va">id</span> <span class="op">&lt;-</span> <span class="va">stPT</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>
  <span class="va">pointDF</span> <span class="op">&lt;-</span> <span class="va">stPT</span><span class="op">[</span><span class="va">stPT</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">id</span>, <span class="op">]</span>
  <span class="va">fwimod</span><span class="op">$</span><span class="va">fwimod</span><span class="op">[</span><span class="va">fwimod</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">id</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">s</span>, y <span class="op">=</span> <span class="va">pointDF</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">fwiobs</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"day"</span>, <span class="st">"fwiobs"</span><span class="op">)</span><span class="op">]</span>
<span class="va">fwiobs</span> <span class="op">&lt;-</span> <span class="va">fwiobs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">fwiobs</span><span class="op">$</span><span class="va">id</span>, <span class="va">fwiobs</span><span class="op">$</span><span class="va">day</span><span class="op">)</span>, <span class="op">]</span>

<span class="va">compareDF</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">full_join</span><span class="op">(</span><span class="va">fwiobs</span>, <span class="va">fwimod</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"day"</span><span class="op">)</span><span class="op">)</span>
<span class="va">compareDF</span> <span class="op">&lt;-</span> <span class="va">compareDF</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">compareDF</span><span class="op">)</span>, <span class="op">]</span>

<span class="co"># GET EQUATION AND R-SQUARED AS STRING (SOURCE: http://goo.gl/K4yh)</span>
<span class="va">compareDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">compareDF</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">lm_eqn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>
    <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, <span class="va">df</span><span class="op">)</span>;
    <span class="va">eq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">==</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span> <span class="op">%.%</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="st">","</span><span class="op">~</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">~</span><span class="st">"="</span><span class="op">~</span><span class="va">r2</span>, 
         <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, 
              b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, 
             r2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">as.expression</a></span><span class="op">(</span><span class="va">eq</span><span class="op">)</span><span class="op">)</span>;                 
<span class="op">}</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">compareDF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fwiobs</span>, y <span class="op">=</span> <span class="va">fwimod</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fl">60</span>, label <span class="op">=</span> <span class="fu">lm_eqn</span><span class="op">(</span><span class="va">compareDF</span><span class="op">)</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"FWI observed"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"FWI modelled"</span><span class="op">)</span>

<span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># Add default OpenStreetMap map tiles</span>
  <span class="fu">addMarkers</span><span class="op">(</span>lng <span class="op">=</span> <span class="va">stPT</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, lat <span class="op">=</span> <span class="va">stPT</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>

<span class="va">thr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"/hugetmp/fire/JAMCpaper/thresholds_geff.rds"</span><span class="op">)</span>

<span class="co"># Recode - from continuous to categorical FWI</span>
<span class="va">FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"obs"</span> <span class="op">=</span> <span class="va">compareDF</span><span class="op">$</span><span class="va">fwiobs</span>, <span class="st">"mod"</span> <span class="op">=</span> <span class="va">compareDF</span><span class="op">$</span><span class="va">fwimod</span><span class="op">)</span>
<span class="co"># Recode FWIobs using Portughese thresholds</span>
<span class="va">FWI</span><span class="op">$</span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cut.html">cut</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FWI</span><span class="op">$</span><span class="va">obs</span>,
               breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8.4</span>, <span class="fl">17.2</span>, <span class="fl">24.6</span>, <span class="fl">38.3</span>, <span class="cn">Inf</span><span class="op">)</span>,
               labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>, <span class="st">"Very high"</span>, <span class="st">"Extreme"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Recode FWImod using caliver's thresholds</span>
<span class="co">#FWI$mod &lt;- cut(x = FWI$mod,</span>
<span class="co">#               breaks = c(0, 8.4, 17.2, 24.6, 38.3, Inf),</span>
<span class="co">#               labels = c("Low", "Moderate", "High", "Very high", "Extreme"))</span>
<span class="va">FWI</span><span class="op">$</span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cut.html">cut</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FWI</span><span class="op">$</span><span class="va">mod</span>,
               breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">14</span>, <span class="fl">28</span>, <span class="fl">52</span>, <span class="cn">Inf</span><span class="op">)</span>,
               labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>, <span class="st">"Very high"</span>, <span class="st">"Extreme"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Correspondence Analysis</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"ca"</span><span class="op">)</span>
<span class="va">mytable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">FWI</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">obs</span>, <span class="va">mod</span><span class="op">)</span><span class="op">)</span> <span class="co"># create a 2 way table</span>
<span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="va">mytable</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># row percentages</span>
<span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="va">mytable</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># column percentages</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">ca</span><span class="op">(</span><span class="va">mytable</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="co"># basic results</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="co"># extended results</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="co"># symmetric map</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">fit</span>, mass <span class="op">=</span> <span class="cn">TRUE</span>, contrib <span class="op">=</span> <span class="st">"absolute"</span>, map <span class="op">=</span>
   <span class="st">"rowgreen"</span>, arrows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># asymmetric map</span></code></pre></div>
</div>
<div id="compare-with-synop---europe-only" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-with-synop---europe-only" class="anchor"></a>Compare with SYNOP - Europe only</h2>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spreadDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"/hugetmp/datadescriptor/spreadDF.rds"</span><span class="op">)</span>
<span class="va">st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"/hugetmp/datadescriptor/stations.rds"</span><span class="op">)</span>
<span class="va">europe</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="op">-</span><span class="fl">25.7</span>, <span class="fl">41.0</span>, <span class="fl">34.5</span>, <span class="fl">71.4</span><span class="op">)</span>, <span class="st">"SpatialPolygons"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">europe</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/projection.html">crs</a></span><span class="op">(</span><span class="va">st</span><span class="op">)</span>
<span class="va">st</span> <span class="op">&lt;-</span> <span class="va">st</span><span class="op">[</span><span class="va">europe</span>,<span class="op">]</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">spreadDF</span><span class="op">[</span><span class="va">spreadDF</span><span class="op">$</span><span class="va">id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">st</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">hour</span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">hour</span> <span class="op">==</span> <span class="fl">12</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">time</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span> <span class="op">==</span> <span class="st">"06"</span>, <span class="op">]</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="op">]</span>
<span class="va">st</span> <span class="op">&lt;-</span> <span class="va">st</span><span class="op">[</span><span class="va">st</span><span class="op">$</span><span class="va">id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">st</span><span class="op">)</span>

<span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"lon"</span>, <span class="st">"lat"</span>, <span class="st">"hour"</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"long"</span>, <span class="st">"lat"</span>, <span class="st">"hour"</span><span class="op">)</span>
<span class="va">df2</span><span class="op">$</span><span class="va">yr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">df2</span><span class="op">$</span><span class="va">mon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">df2</span><span class="op">$</span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/day.html">day</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">df2</span><span class="op">$</span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">`2t`</span> <span class="op">-</span> <span class="fl">273.15</span>
<span class="va">df2</span><span class="op">$</span><span class="va">rh</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">rh</span>
<span class="va">df2</span><span class="op">$</span><span class="va">ws</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">`10ff`</span> <span class="op">*</span> <span class="fl">3.6</span>
<span class="va">df2</span><span class="op">$</span><span class="va">prec</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">tp</span>

<span class="co"># Remove stations with zero variance related to tp (often missing info)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/aggregate.html">aggregate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"temp"</span>, <span class="st">"rh"</span>, <span class="st">"ws"</span>, <span class="st">"prec"</span><span class="op">)</span><span class="op">]</span>,
               by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">id</span>, <span class="va">df2</span><span class="op">$</span><span class="va">hour</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">var</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,<span class="op">]</span>

<span class="va">rows2remove</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">prec</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group.1"</span>, <span class="st">"Group.2"</span><span class="op">)</span><span class="op">]</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">rows2remove</span><span class="op">$</span><span class="va">Group.1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">rows2remove</span><span class="op">$</span><span class="va">Group.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">id</span> <span class="op">&lt;-</span> <span class="va">rows2remove</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span><span class="op">]</span>
  <span class="va">hour</span> <span class="op">&lt;-</span> <span class="va">rows2remove</span><span class="op">[</span><span class="va">i</span>, <span class="fl">2</span><span class="op">]</span>
  <span class="va">j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">id</span> <span class="op">&amp;</span> <span class="va">df2</span><span class="op">$</span><span class="va">hour</span> <span class="op">==</span> <span class="va">hour</span><span class="op">)</span>
  <span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">df2</span><span class="op">[</span><span class="op">-</span><span class="va">j</span>, <span class="op">]</span>
<span class="op">}</span>

<span class="co"># Initialise</span>
<span class="va">df2</span><span class="op">$</span><span class="va">fwiobs</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">df2</span><span class="op">$</span><span class="va">fwimod</span> <span class="op">&lt;-</span> <span class="cn">NA</span>

<span class="co"># We want at least 1 month of data</span>
<span class="va">aboveXdays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span> <span class="op">==</span> <span class="fl">30</span><span class="op">)</span><span class="op">]</span>
<span class="co"># Data for the table</span>
<span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">df2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">%in%</span> <span class="va">aboveXdays</span><span class="op">)</span>

<span class="va">fwi2017</span> <span class="op">&lt;-</span>  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"/hugetmp/datadescriptor/fwi2017rt.nc"</span><span class="op">)</span>
<span class="va">world</span> <span class="op">&lt;-</span> <span class="va">fwi2017</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="va">world</span><span class="op">[</span><span class="va">world</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>

<span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"FIG7.png"</span>, units <span class="op">=</span> <span class="st">"px"</span>, width <span class="op">=</span> <span class="fl">650</span>, height <span class="op">=</span> <span class="fl">600</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">world</span>, col <span class="op">=</span> <span class="st">"gray88"</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>,
             xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">25.7</span>, <span class="fl">41.0</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">34.5</span>, <span class="fl">71.4</span><span class="op">)</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">st</span><span class="op">[</span><span class="va">st</span><span class="op">$</span><span class="va">id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, <span class="op">]</span>, col <span class="op">=</span> <span class="st">"indianred3"</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># GET FORECASTS</span>
<span class="va">DAY</span> <span class="op">&lt;-</span> <span class="fl">6</span>
<span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2017-06-01"</span>
<span class="va">end_date</span> <span class="op">&lt;-</span> <span class="st">"2017-06-30"</span>
<span class="va">mydays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">start_date</span><span class="op">)</span>, to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">end_date</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"days"</span><span class="op">)</span>
<span class="va">fwi2017</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="va">mydays</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="va">newdate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">newdate</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">newdate</span><span class="op">)</span>
  <span class="va">myFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/hugetmp/fire/geff/forecast/fwi2017/ffwi_rotated"</span>,
                        pattern <span class="op">=</span> <span class="va">newdate</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">fwi2017</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">fwi2017</span>, <span class="va">myFiles</span><span class="op">[</span><span class="va">DAY</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">fwi2017</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mydays</span>
    
<span class="co"># Add observed and modelled FWI</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

  <span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">myrows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="va">id</span><span class="op">)</span>
  <span class="va">df2X</span> <span class="op">&lt;-</span> <span class="va">df2</span><span class="op">[</span><span class="va">myrows</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>
  <span class="co"># unique points</span>
  <span class="va">pointsdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/unique.html">unique</a></span><span class="op">(</span><span class="va">df2X</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/xyFromCell.html">coordinates</a></span><span class="op">(</span><span class="va">pointsdf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">long</span> <span class="op">+</span> <span class="va">lat</span>
  <span class="co"># intial conditions</span>
  <span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ffmc <span class="op">=</span> <span class="fl">85</span>, dmc <span class="op">=</span> <span class="fl">6</span>, dc <span class="op">=</span> <span class="fl">15</span>, lat <span class="op">=</span> <span class="va">pointsdf</span><span class="op">@</span><span class="va">coords</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
  <span class="co"># Calculate the observed FWI</span>
  <span class="va">df2</span><span class="op">$</span><span class="va">fwiobs</span><span class="op">[</span><span class="va">myrows</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">cffdrs</span><span class="fu">::</span><span class="fu">fwi</span><span class="op">(</span>input <span class="op">=</span> <span class="va">df2X</span>, init <span class="op">=</span> <span class="va">init</span>, out <span class="op">=</span> <span class="st">"fwi"</span><span class="op">)</span><span class="op">$</span><span class="va">FWI</span>
  <span class="co"># Extract the modelled FWI from reanalysis</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fwi2017</span>, y <span class="op">=</span> <span class="va">pointsdf</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"All data are NAs!"</span><span class="op">)</span>
  <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
    <span class="va">df2</span><span class="op">$</span><span class="va">fwimod</span><span class="op">[</span><span class="va">myrows</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="co"># Remove rows with incomplete records</span>
<span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">df2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">df2</span>, file <span class="op">=</span> <span class="st">"dfEuropeJune2017ForecastFWIday6.rds"</span><span class="op">)</span>
<span class="co"># df2 &lt;- readRDS("dfEuropeJune2017ForecastFWIday6.rds")</span>

<span class="co"># Francesca's contour plot</span>
<span class="va">fudgeit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span>
        <span class="va">xm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="st">'xm'</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
        <span class="va">ym</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="st">'ym'</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
        <span class="va">z</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="st">'dens'</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>  
        <span class="va">colramp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="st">'colramp'</span>, <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
        <span class="fu">image.plot</span><span class="op">(</span><span class="va">xm</span>, <span class="va">ym</span>, <span class="va">z</span>, col <span class="op">=</span> <span class="fu">colramp</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span>, legend.only <span class="op">=</span> <span class="cn">T</span>, add <span class="op">=</span><span class="cn">F</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">Lab.palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"blue"</span>, <span class="st">"yellow"</span>, <span class="st">"maroon"</span>, <span class="st">"red"</span><span class="op">)</span>,
                                space <span class="op">=</span> <span class="st">"Lab"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">.1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/smoothScatter.html">smoothScatter</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">fwiobs</span>,<span class="va">df2</span><span class="op">$</span><span class="va">fwimod</span>, nrpoints <span class="op">=</span> <span class="fl">0</span>, postPlotHook<span class="op">=</span><span class="va">fudgeit</span>,
              xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">120</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">120</span><span class="op">)</span>,
              colramp <span class="op">=</span> <span class="va">Lab.palette</span>, pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">0.5</span>,
              xlab <span class="op">=</span> <span class="st">"FWI observed"</span>, ylab <span class="op">=</span> <span class="st">"FWI modelled"</span><span class="op">)</span></code></pre></div>
</div>
<div id="compare-synop-worldwide" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-synop-worldwide" class="anchor"></a>Compare SYNOP worldwide</h2>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"/hugetmp/publications/geff-erai_datadescriptor/datasets/df_all.rds"</span><span class="op">)</span>
<span class="va">stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"/hugetmp/publications/geff-erai_datadescriptor/datasets/stations_all.rds"</span><span class="op">)</span>

<span class="co"># FWI from reanalysis</span>
<span class="va">fwi2017</span> <span class="op">&lt;-</span>  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"/hugetmp/publications/geff-erai_datadescriptor/datasets/fwi2017re.nc"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">fwi2017</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2017-01-01"</span><span class="op">)</span>,
                           to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2017-12-31"</span><span class="op">)</span>,
                           by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>

<span class="co"># Get forecasts for day 2-6-10</span>
<span class="va">day2FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">day6FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">day10FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">file</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"/hugetmp/FireEventsDatabase/fwi2017/ffwi_rotated"</span>,
                        pattern <span class="op">=</span> <span class="st">"*hr.nc"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span>
  <span class="va">day2FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">day2FWI</span>, <span class="va">x</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">day6FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">day6FWI</span>, <span class="va">x</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">day10FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">day10FWI</span>, <span class="va">x</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">df_used</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">df_used</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"lat"</span>, <span class="st">"long"</span>, <span class="st">"UTCtime"</span>, <span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span>, <span class="st">"hour"</span>,
                    <span class="st">"temp"</span>, <span class="st">"prec"</span>, <span class="st">"rh"</span>, <span class="st">"ws"</span>, <span class="st">"fwiobs"</span>, <span class="st">"fwimod_re"</span>,
                    <span class="st">"fwimod_d2"</span>, <span class="st">"fwimod_d6"</span>, <span class="st">"fwimod_d10"</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">stations</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>

  <span class="co"># We filter over the station</span>
  <span class="va">dfx</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">stations</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
                       <span class="va">lat</span> <span class="op">==</span> <span class="va">stations</span><span class="op">$</span><span class="va">lat</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,
                       <span class="va">long</span> <span class="op">==</span> <span class="va">stations</span><span class="op">$</span><span class="va">long</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span><span class="op">(</span><span class="va">dfx</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span><span class="op">(</span><span class="va">dfx</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="fl">30</span><span class="op">)</span><span class="op">{</span>
    <span class="co"># Calculate the observed FWI</span>
    <span class="va">initial_condition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ffmc <span class="op">=</span> <span class="fl">85</span>, dmc <span class="op">=</span> <span class="fl">6</span>, dc <span class="op">=</span> <span class="fl">15</span>,
                                    lat <span class="op">=</span> <span class="va">dfx</span><span class="op">$</span><span class="va">lat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
    <span class="va">dfx</span><span class="op">$</span><span class="va">fwiobs</span> <span class="op">&lt;-</span> <span class="fu">cffdrs</span><span class="fu">::</span><span class="fu">fwi</span><span class="op">(</span>input <span class="op">=</span> <span class="va">dfx</span>,
                              init <span class="op">=</span> <span class="va">initial_condition</span>,
                              out <span class="op">=</span> <span class="st">"fwi"</span><span class="op">)</span><span class="op">$</span><span class="va">FWI</span>
    
    <span class="co"># Define spatial point</span>
    <span class="va">spdf</span> <span class="op">&lt;-</span> <span class="va">dfx</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>
    <span class="co"># Promote data.frame to spatial</span>
    <span class="fu"><a href="https://rdrr.io/pkg/raster/man/xyFromCell.html">coordinates</a></span><span class="op">(</span><span class="va">spdf</span><span class="op">)</span> <span class="op">=</span> <span class="op">~</span><span class="va">long</span> <span class="op">+</span> <span class="va">lat</span>
    
    <span class="co"># Select timestamp</span>
    <span class="va">mytimestamps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">fwi2017</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">11</span><span class="op">)</span> <span class="op">%in%</span>
                            <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">dfx</span><span class="op">$</span><span class="va">yr</span>, <span class="st">"."</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%02d"</span>, <span class="va">dfx</span><span class="op">$</span><span class="va">mon</span><span class="op">)</span>, <span class="st">"."</span>,
                                   <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%02d"</span>, <span class="va">dfx</span><span class="op">$</span><span class="va">day</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

    <span class="co"># Extract the modelled FWI from reanalysis</span>
    <span class="va">temp_re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fwi2017</span>, y <span class="op">=</span> <span class="va">spdf</span><span class="op">)</span><span class="op">)</span>
    <span class="va">dfx</span><span class="op">$</span><span class="va">fwimod_re</span> <span class="op">&lt;-</span> <span class="va">temp_re</span><span class="op">[</span><span class="va">mytimestamps</span><span class="op">]</span>
    
    <span class="co"># Extract the modelled FWI from HRES day 2</span>
    <span class="va">temp_d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">day2FWI</span>, y <span class="op">=</span> <span class="va">spdf</span><span class="op">)</span><span class="op">)</span>
    <span class="va">dfx</span><span class="op">$</span><span class="va">fwimod_d2</span> <span class="op">&lt;-</span> <span class="va">temp_d2</span><span class="op">[</span><span class="va">mytimestamps</span><span class="op">]</span>
    
    <span class="co"># Extract the modelled FWI from HRES day 6</span>
    <span class="va">temp_d6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">day6FWI</span>, y <span class="op">=</span> <span class="va">spdf</span><span class="op">)</span><span class="op">)</span>
    <span class="va">dfx</span><span class="op">$</span><span class="va">fwimod_d6</span> <span class="op">&lt;-</span> <span class="va">temp_d6</span><span class="op">[</span><span class="va">mytimestamps</span><span class="op">]</span>
    
    <span class="co"># Extract the modelled FWI from HRES day 10</span>
    <span class="va">temp_d10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">day10FWI</span>, y <span class="op">=</span> <span class="va">spdf</span><span class="op">)</span><span class="op">)</span>
    <span class="va">dfx</span><span class="op">$</span><span class="va">fwimod_d10</span> <span class="op">&lt;-</span> <span class="va">temp_d10</span><span class="op">[</span><span class="va">mytimestamps</span><span class="op">]</span>

    <span class="va">df_used</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">bind_rows</span><span class="op">(</span><span class="va">df_used</span>, <span class="va">dfx</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">mytimestamps</span>, <span class="va">temp_re</span>, <span class="va">temp_d2</span>, <span class="va">temp_d6</span>, <span class="va">temp_d10</span>, <span class="va">initial_condition</span>, <span class="va">dfx</span><span class="op">)</span>
  <span class="op">}</span>

<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df_used</span>, <span class="st">"SYNOPtable.rds"</span><span class="op">)</span>

<span class="co"># Remove NAs</span>
<span class="va">df_temp</span> <span class="op">&lt;-</span> <span class="va">df_used</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">df_used</span><span class="op">)</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df_temp</span>, <span class="st">"SYNOPtable_no_missing.rds"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># MAP LENGTH OF FIRE SEASON BASED ON 5C THRESHOLD</span>
<span class="co"># /perm/rd/nen/claudia</span>
<span class="va">era</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"/perm/rd/nen/claudia/era_t2_an_daymax.nc"</span><span class="op">)</span>
<span class="va">fire_length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/calc.html">calc</a></span><span class="op">(</span><span class="va">era</span>, <span class="fu">caliver</span><span class="fu">::</span><span class="va"><a href="../reference/get_fire_season_length.html">get_fire_season_length</a></span><span class="op">)</span>
<span class="co"># Open a file</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span><span class="op">(</span><span class="st">"fire_season_length.png"</span>, width <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> 
<span class="co"># 2. Create a plot</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rotate.html">rotate</a></span><span class="op">(</span><span class="va">fire_length</span>, main <span class="op">=</span> <span class="st">"Fire season length"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span><span class="op">(</span><span class="st">"world"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span>
<span class="co"># Close the file</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="scoring-rules" class="section level2">
<h2 class="hasAnchor">
<a href="#scoring-rules" class="anchor"></a>SCORING RULES</h2>
<p>Extract reanalysis and forecasted values.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># FWI reanalysis dataset, GEFF reanalysis v2.0</span>
<span class="co"># rasterTmpFile('/hugetmp/tmpdir/')</span>
<span class="va">BasisRegions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"BasisRegions_simplified.rds"</span><span class="op">)</span>
<span class="va">FWI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"/hugetmp/GEFF_ERAI_Zenodo/fwi.nc"</span><span class="op">)</span> <span class="co"># 7GB!</span>
<span class="va">rea</span> <span class="op">&lt;-</span> <span class="va">FWI</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">FWI</span><span class="op">@</span><span class="va">z</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">==</span> <span class="st">"2017"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="co"># only 2017</span>
<span class="va">ens_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="st">"/hugetmp/FireEventsDatabase/fwi2017/ffwi_rotated/cfwis_ffwi_20170101_1200_00.nc"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co"># Resample so that reanalysis and ens have same cells</span>
<span class="va">rea_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html">resample</a></span><span class="op">(</span><span class="va">rea</span>, <span class="va">ens_test</span>, progress <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span>
<span class="va">year2017</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2017-01-01"</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2017-12-31"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
<span class="va">dfre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">365</span>, <span class="fl">1</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span>
<span class="va">df02</span> <span class="op">&lt;-</span> <span class="va">df06</span> <span class="op">&lt;-</span> <span class="va">df10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">365</span>, <span class="fl">51</span>, <span class="fl">14</span><span class="op">)</span><span class="op">)</span>
<span class="co"># seq_along(year2017) # corrupted: 108,42,: and i = 324-344</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">year2017</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">year2017</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="co"># Find cells in reanalysis where FWI &gt; 5</span>
  <span class="co">#rea_mask &lt;- rea_res[[i]] &gt; 5</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span><span class="op">{</span>
    <span class="co"># print(k)</span>
    <span class="co"># Find average FWI by region</span>
    <span class="va">rea_cropped</span> <span class="op">&lt;-</span> <span class="fu">caliver</span><span class="fu">::</span><span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span><span class="va">rea_res</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">BasisRegions</span><span class="op">[</span><span class="va">k</span>, <span class="op">]</span><span class="op">)</span>
    <span class="va">dfre</span><span class="op">[</span><span class="va">i</span>, <span class="fl">1</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cellStats.html">cellStats</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rea_cropped</span>, stat <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span><span class="op">{</span>
      <span class="va">ens_member</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">j</span>, <span class="fl">2</span>, pad <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span>
      <span class="va">file_ens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"/hugetmp/FireEventsDatabase/fwi2017/ffwi_rotated/cfwis_ffwi_"</span>,
                         <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"-"</span>, replacement <span class="op">=</span> <span class="st">""</span>, <span class="va">year2017</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,
                         <span class="st">"_1200_"</span>, <span class="va">ens_member</span>, <span class="st">".nc"</span><span class="op">)</span>
      <span class="va">ens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">file_ens</span><span class="op">)</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>
      <span class="va">ens_cropped</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu">caliver</span><span class="fu">::</span><span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span><span class="va">ens</span>, <span class="va">BasisRegions</span><span class="op">[</span><span class="va">k</span>, <span class="op">]</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">ens_cropped</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"try-error"</span><span class="op">)</span><span class="op">{</span>
        <span class="va">df02</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cellStats.html">cellStats</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ens_cropped</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, stat <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
        <span class="va">df06</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cellStats.html">cellStats</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ens_cropped</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, stat <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
        <span class="va">df10</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">k</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cellStats.html">cellStats</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ens_cropped</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, stat <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
      <span class="op">}</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">dfre</span>, <span class="st">"dfre.rds"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df02</span>, <span class="st">"df02.rds"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df06</span>, <span class="st">"df06.rds"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df10</span>, <span class="st">"df10.rds"</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Remove NAs - some files may be corrupted</span>
<span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dfre</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">dfre</span> <span class="op">&lt;-</span> <span class="va">dfre</span><span class="op">[</span><span class="va">idx</span>, , <span class="op">]</span>
<span class="va">df02</span> <span class="op">&lt;-</span> <span class="va">df02</span><span class="op">[</span><span class="va">idx</span>, , <span class="op">]</span>
<span class="va">df06</span> <span class="op">&lt;-</span> <span class="va">df06</span><span class="op">[</span><span class="va">idx</span>, , <span class="op">]</span>
<span class="va">df10</span> <span class="op">&lt;-</span> <span class="va">df10</span><span class="op">[</span><span class="va">idx</span>, , <span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">dfre</span>, <span class="st">"dfre_noNAs.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df02</span>, <span class="st">"df02_noNAs.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df06</span>, <span class="st">"df06_noNAs.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">df10</span>, <span class="st">"df10_noNAs.rds"</span><span class="op">)</span></code></pre></div>
<p>Use the above values for plotting.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggridges</span><span class="op">)</span>

<span class="va">dfre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"dfre_noNAs.rds"</span><span class="op">)</span>
<span class="va">df02</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"df02_noNAs.rds"</span><span class="op">)</span>
<span class="va">df06</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"df06_noNAs.rds"</span><span class="op">)</span>
<span class="va">df10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"df10_noNAs.rds"</span><span class="op">)</span>
<span class="va">xdays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html">dim</a></span><span class="op">(</span><span class="va">dfre</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">region</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tdf_re</span> <span class="op">&lt;-</span> <span class="va">dfre</span><span class="op">[</span>, <span class="va">region</span><span class="op">]</span>
  <span class="va">tdf_02</span> <span class="op">&lt;-</span> <span class="va">df02</span><span class="op">[</span>, , <span class="va">region</span><span class="op">]</span>
  <span class="va">tdf_06</span> <span class="op">&lt;-</span> <span class="va">df06</span><span class="op">[</span>, , <span class="va">region</span><span class="op">]</span>
  <span class="va">tdf_10</span> <span class="op">&lt;-</span> <span class="va">df10</span><span class="op">[</span>, , <span class="va">region</span><span class="op">]</span>
  <span class="co"># Calculate Biases</span>
  <span class="va">tdf_02b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">tdf_02</span> <span class="op">-</span> <span class="va">tdf_re</span><span class="op">)</span>
  <span class="va">tdf_06b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">tdf_06</span> <span class="op">-</span> <span class="va">tdf_re</span><span class="op">)</span>
  <span class="va">tdf_10b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">tdf_10</span> <span class="op">-</span> <span class="va">tdf_re</span><span class="op">)</span>
  <span class="co"># Rbind and Melt</span>
  <span class="va">tdf_02b</span><span class="op">$</span><span class="va">Day</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">xdays</span>; <span class="va">tdf_02b</span><span class="op">$</span><span class="va">Leadtime</span> <span class="op">&lt;-</span> <span class="fl">2</span>
  <span class="va">tdf_06b</span><span class="op">$</span><span class="va">Day</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">xdays</span>; <span class="va">tdf_06b</span><span class="op">$</span><span class="va">Leadtime</span> <span class="op">&lt;-</span> <span class="fl">6</span>
  <span class="va">tdf_10b</span><span class="op">$</span><span class="va">Day</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="va">xdays</span>; <span class="va">tdf_10b</span><span class="op">$</span><span class="va">Leadtime</span> <span class="op">&lt;-</span> <span class="fl">10</span>
  <span class="va">tdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">tdf_02b</span>, <span class="va">tdf_06b</span>, <span class="va">tdf_10b</span><span class="op">)</span>
  <span class="va">tdfm</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">tdf</span>, id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span>, <span class="st">"Leadtime"</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># grouped boxplot</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tdfm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Day</span>, y<span class="op">=</span><span class="va">value</span>, group <span class="op">=</span> <span class="va">Leadtime</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span><span class="op">(</span><span class="fl">3</span>, s <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">Leadtime</span>, data <span class="op">=</span> <span class="va">tdfm</span>, col <span class="op">=</span> <span class="va">cols</span>,
          names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day2"</span>, <span class="st">"Day6"</span>, <span class="st">"Day10"</span><span class="op">)</span>,
          horizontal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="co"># Calculate ensemble means</span>
  <span class="co"># tdf_02_mean &lt;- apply(X = tdf_02, MARGIN = 1, FUN = mean)</span>
  <span class="co"># tdf_06_mean &lt;- apply(X = tdf_06, MARGIN = 1, FUN = mean)</span>
  <span class="co"># tdf_10_mean &lt;- apply(X = tdf_10, MARGIN = 1, FUN = mean)</span>
  <span class="co"># Melt data.frames</span>
  <span class="co"># tdf_rem &lt;- data.frame(Day = 1:xdays, REA = tdf_re)</span>
  <span class="co"># tdf_rem &lt;- do.call("rbind",</span>
  <span class="co">#                    replicate(51, tdf_rem, simplify = FALSE))</span>
  <span class="co"># tdf_rem &lt;- cbind(tdf_rem, Member = rep(1:51, each = xdays))</span>
  <span class="co"># tdf_rem &lt;- tdf_rem[, c(1, 3, 2)]</span>
  <span class="co"># tdfrem &lt;- reshape2::melt(tdf_rem, id=c("Day", "Member"))</span>
  <span class="co"># tdfrem02 &lt;- tdfrem; tdfrem02$variable &lt;- "D02"</span>
  <span class="co"># tdfrem06 &lt;- tdfrem; tdfrem06$variable &lt;- "D06"</span>
  <span class="co"># tdfrem10 &lt;- tdfrem; tdfrem10$variable &lt;- "D10"</span>
  <span class="co"># tdfrem &lt;- rbind(tdfrem02, tdfrem06, tdfrem10)</span>
  <span class="co"># tdf_02m &lt;- reshape2::melt(tdf_02); names(tdf_02m) &lt;- c("Day", "Member", "D02")</span>
  <span class="co"># tdf_06m &lt;- reshape2::melt(tdf_06); names(tdf_06m) &lt;- c("Day", "Member", "D06")</span>
  <span class="co"># tdf_10m &lt;- reshape2::melt(tdf_10); names(tdf_10m) &lt;- c("Day", "Member", "D10")</span>
  <span class="co"># tdf &lt;- cbind(tdf_02m, D06 = tdf_06m$D06, D10 = tdf_10m$D10)</span>
  <span class="co"># tdfm &lt;- reshape2::melt(tdf, id=c("Day", "Member"))</span>
  <span class="co"># Boxplots</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">tdfrem</span><span class="op">$</span><span class="va">value</span>, <span class="va">tdf_02m</span><span class="op">$</span><span class="va">D02</span>, <span class="va">tdf_06m</span><span class="op">$</span><span class="va">D06</span>, <span class="va">tdf_10m</span><span class="op">$</span><span class="va">D10</span><span class="op">)</span>
  <span class="co"># Densities</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tdfm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">variable</span>, fill<span class="op">=</span><span class="va">variable</span><span class="op">)</span>,
                 alpha<span class="op">=</span><span class="fl">0.5</span>, adjust<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tdfrem</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, fill<span class="op">=</span><span class="st">"REA"</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, adjust<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12.5</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"FWI"</span><span class="op">)</span>
  <span class="co"># Conduct one-way ANOVA</span>
  <span class="va">tdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tdf_rem</span><span class="op">$</span><span class="va">REA</span>, <span class="va">tdf_02m</span><span class="op">$</span><span class="va">D02</span>, <span class="va">tdf_06m</span><span class="op">$</span><span class="va">D06</span>, <span class="va">tdf_10m</span><span class="op">$</span><span class="va">D10</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tdf_stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">tdf</span><span class="op">)</span>
  <span class="va">anova1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">values</span> <span class="op">~</span> <span class="va">ind</span>, data <span class="op">=</span> <span class="va">tdf_stack</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">anova1</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/TukeyHSD.html">TukeyHSD</a></span><span class="op">(</span><span class="va">anova1</span><span class="op">)</span>
  <span class="co"># Plot time series</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tdfm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">Member</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"lightgray"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tdfrem</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Day</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">Member</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">xdays</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"FWI"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Continuous Ranked Probability Score for ensemble forecasts</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"dfre_noNAs.rds"</span><span class="op">)</span>
<span class="va">df02</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"df02_noNAs.rds"</span><span class="op">)</span>
<span class="va">df06</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"df06_noNAs.rds"</span><span class="op">)</span>
<span class="va">df10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"df10_noNAs.rds"</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"easyVerification"</span><span class="op">)</span>

<span class="va">crps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">region</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">14</span><span class="op">)</span><span class="op">{</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span>
  
  <span class="va">fc_Mem_02</span> <span class="op">&lt;-</span> <span class="va">df02</span><span class="op">[</span>, , <span class="va">region</span><span class="op">]</span>
  <span class="va">fc_Mem_06</span> <span class="op">&lt;-</span> <span class="va">df06</span><span class="op">[</span>, , <span class="va">region</span><span class="op">]</span>
  <span class="va">fc_Mem_10</span> <span class="op">&lt;-</span> <span class="va">df10</span><span class="op">[</span>, , <span class="va">region</span><span class="op">]</span>
  <span class="va">Obs</span> <span class="op">&lt;-</span> <span class="va">dfre</span><span class="op">[</span>, <span class="va">region</span><span class="op">]</span>
  
  <span class="va">CRPS_FC_02</span> <span class="op">&lt;-</span> <span class="fu">veriApply</span><span class="op">(</span>verifun <span class="op">=</span> <span class="st">"EnsCrps"</span>, fcst <span class="op">=</span> <span class="va">fc_Mem_02</span>, obs <span class="op">=</span> <span class="va">Obs</span><span class="op">)</span>
  <span class="va">CRPS_FC_06</span> <span class="op">&lt;-</span> <span class="fu">veriApply</span><span class="op">(</span>verifun <span class="op">=</span> <span class="st">"EnsCrps"</span>, fcst <span class="op">=</span> <span class="va">fc_Mem_06</span>, obs <span class="op">=</span> <span class="va">Obs</span><span class="op">)</span>
  <span class="va">CRPS_FC_10</span> <span class="op">&lt;-</span> <span class="fu">veriApply</span><span class="op">(</span>verifun <span class="op">=</span> <span class="st">"EnsCrps"</span>, fcst <span class="op">=</span> <span class="va">fc_Mem_10</span>, obs <span class="op">=</span> <span class="va">Obs</span><span class="op">)</span>
  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>day02 <span class="op">=</span> <span class="va">CRPS_FC_02</span>,
                     day06 <span class="op">=</span> <span class="va">CRPS_FC_06</span>,
                     day10 <span class="op">=</span> <span class="va">CRPS_FC_10</span><span class="op">)</span>
  <span class="va">tmp</span><span class="op">$</span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">343</span>
  <span class="va">tmp</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="va">region</span>
  
  <span class="va">crps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">crps</span>, <span class="va">tmp</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">crps</span>, file <span class="op">=</span> <span class="st">"crps.rds"</span><span class="op">)</span>

<span class="co"># Daily mean across regions</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>
<span class="va">crps_mean</span> <span class="op">&lt;-</span> <span class="va">crps</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">day</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>Day2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">enframe</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/quantile.html">quantile</a></span><span class="op">(</span><span class="va">day02</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.10</span>, <span class="fl">0.50</span>, <span class="fl">0.90</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
            Day6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">enframe</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/quantile.html">quantile</a></span><span class="op">(</span><span class="va">day06</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.10</span>, <span class="fl">0.50</span>, <span class="fl">0.90</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
            Day10 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">enframe</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/quantile.html">quantile</a></span><span class="op">(</span><span class="va">day10</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.10</span>, <span class="fl">0.50</span>, <span class="fl">0.90</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">unnest</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/select.html">select</a></span><span class="op">(</span><span class="va">day</span>, <span class="va">name</span>, <span class="va">value</span>, <span class="va">value1</span>, <span class="va">value2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>Day <span class="op">=</span> <span class="va">day</span>, Prob <span class="op">=</span> <span class="va">name</span>, Day2 <span class="op">=</span> <span class="va">value</span>, Day6 <span class="op">=</span> <span class="va">value1</span>, Day10 <span class="op">=</span> <span class="va">value2</span><span class="op">)</span>
<span class="co"># Plot quantiles</span>
<span class="va">crps_long</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">crps_mean</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Day"</span>, <span class="st">"Prob"</span><span class="op">)</span><span class="op">)</span> <span class="co"># convert to long format</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">crps_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Day</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">Prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">variable</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Day of year"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"CRPS"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'#999999'</span>,<span class="st">'#E69F00'</span>, <span class="st">'#999999'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">343</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># Plot histograms</span>
<span class="va">crps_hist</span> <span class="op">&lt;-</span> <span class="va">crps</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">day</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>Day2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">day02</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            Day6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">day06</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            Day10 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">day10</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="va">crps_hist</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">crps_hist</span>, id <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crps_hist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">value</span>, color<span class="op">=</span><span class="va">variable</span>, fill<span class="op">=</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>position<span class="op">=</span><span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span>


<span class="co"># Example plot</span>
<span class="va">crps_long</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">crps</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"day"</span>, <span class="st">"region"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># convert to long format</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">crps_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">day</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">region</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span>

<span class="co"># Region X</span>
<span class="va">region</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">df02</span><span class="op">[</span>, , <span class="va">region</span><span class="op">]</span><span class="op">)</span>
<span class="va">x</span><span class="op">$</span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">343</span>
<span class="va">x</span><span class="op">$</span><span class="va">rea</span> <span class="op">&lt;-</span> <span class="va">dfre</span><span class="op">[</span>, <span class="va">region</span><span class="op">]</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">x</span>, id <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
<span class="va">x</span><span class="op">$</span><span class="va">Type</span> <span class="op">&lt;-</span> <span class="st">"Ensemble"</span>; <span class="va">x</span><span class="op">$</span><span class="va">Type</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">variable</span> <span class="op">==</span> <span class="st">"rea"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Reanalysis"</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">x</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">day</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">Type</span>, group <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'#999999'</span>,<span class="st">'#E69F00'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="refs" class="references">
<div id="ref-digiuseppe:2018">
<p>Di Giuseppe, Francesca, Claudia Vitolo, Jesus San Miguel, Blazej Krzeminski, and Florian Pappenberger. n.d. “Fire Danger: The Prediction Skill Provided by Ecmwf Integrated Forecasting System.” <em>Journal of Applied Meteorology and Climatology</em>.</p>
</div>
<div id="ref-vitolo:2018">
<p>Vitolo, Claudia, Francesca Di Giuseppe, and Mirko D’Andrea. 2018. “Caliver: An R Package for Calibration and Verification of Forest Fire Gridded Model Outputs.” <em>PLOS ONE</em> 13 (1): 1–18. <a href="https://doi.org/10.1371/journal.pone.0189419">https://doi.org/10.1371/journal.pone.0189419</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Claudia Vitolo, Mirko D'Andrea.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
